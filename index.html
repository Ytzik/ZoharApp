<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ZoharApp - Welcome</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Assistant:wght@400;600;800&display=swap');
        :root {
            --rose: #fb7185; --bg: #f8fafc; --card-bg: white; --text: #1e293b;
            --indigo: #6366f1; --amber: #f59e0b; --green: #10b981; --blue: #3b82f6; --cyan: #06b6d4; --red: #ef4444;
        }
        body.night-mode { --bg: #0f172a; --card-bg: #1e293b; --text: #f1f5f9; }
        * { box-sizing: border-box; font-family: 'Assistant', sans-serif; -webkit-tap-highlight-color: transparent; }
        body { background-color: var(--bg); color: var(--text); margin: 0; transition: 0.3s; min-height: 100vh; padding-bottom: 30px; }
        .container { max-width: 450px; margin: 0 auto; padding: 15px; }

        /* Welcome Screen Styling */
        .welcome-card {
            background: var(--card-bg); padding: 30px; border-radius: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1); text-align: center;
            margin-top: 50px; border-top: 8px solid var(--rose);
        }
        .welcome-card h1 { color: var(--rose); font-size: 28px; margin-bottom: 10px; }
        .welcome-card p { opacity: 0.7; margin-bottom: 25px; }

        /* Bento Grid */
        .summary-box {
            background: linear-gradient(135deg, var(--rose), #fda4af); color: white; padding: 20px;
            border-radius: 24px; margin-bottom: 20px; display: flex; justify-content: space-around;
            box-shadow: 0 8px 20px rgba(251,113,133,0.3); text-align: center;
        }
        .sum-val { font-size: 24px; font-weight: 800; display: block; }
        .sum-lbl { font-size: 11px; opacity: 0.9; }

        .bento-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 15px; }
        .bento-card {
            background: var(--card-bg); border-radius: 20px; padding: 15px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05); display: flex; flex-direction: column;
            cursor: pointer; transition: transform 0.1s; border-bottom: 4px solid rgba(0,0,0,0.05);
        }
        .bento-card:active { transform: scale(0.96); }
        .bento-card.wide { grid-column: span 2; flex-direction: row; align-items: center; justify-content: space-between; }
        .card-icon { font-size: 24px; margin-bottom: 8px; }
        .card-title { font-weight: 800; font-size: 15px; margin: 0; }
        .card-info { font-size: 10px; color: var(--rose); font-weight: bold; margin-top: 4px; }
        
        .active-sleep { background: var(--indigo) !important; color: white !important; animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.8; } }

        /* Screens */
        .screen { display: none; }
        .screen.active { display: block; }
        .btn-bar {
            width: 100%; background: var(--card-bg); border: none; padding: 16px; border-radius: 18px;
            margin-bottom: 10px; font-size: 17px; font-weight: 800; color: var(--text);
            cursor: pointer; border-bottom: 4px solid rgba(0,0,0,0.1); display: flex;
            justify-content: space-between; align-items: center;
        }
        .timer { font-size: 55px; text-align: center; color: var(--rose); margin: 20px 0; font-family: monospace; font-weight: 800; }
        input, select { width: 100%; padding: 14px; margin-bottom: 15px; border: 1px solid #ddd; border-radius: 15px; font-size: 16px; background: var(--card-bg); color: var(--text); }
        
        #toast { visibility: hidden; min-width: 200px; background: #1e293b; color: white; text-align: center; border-radius: 50px; padding: 12px; position: fixed; left: 50%; transform: translateX(-50%); bottom: 30px; z-index: 1000; font-weight: bold; }
        #toast.show { visibility: visible; }
    </style>
</head>
<body>

<div id="toast">× ×©××¨! âœ¨</div>

<div class="container">
    
    <div id="scr-onboarding" class="screen">
        <div class="welcome-card">
            <h1>××–×œ ×˜×•×‘! ğŸ¼</h1>
            <p>×™×© ×œ× ×• ×‘×™×™×‘×™ ×—×“×© ×‘××©×¤×—×”. ×‘×•××• × ×›× ×™×¡ ×¤×¨×˜×™× ×¨××©×•× ×™×:</p>
            <input type="text" id="baby-name" placeholder="×©× ×”×ª×™× ×•×§/×ª">
            <select id="baby-gender">
                <option value="">××™×Ÿ ×”×™×œ×•×“</option>
                <option value="×–×›×¨">×–×›×¨</option>
                <option value="× ×§×‘×”">× ×§×‘×”</option>
            </select>
            <input type="date" id="baby-dob" placeholder="×ª××¨×™×š ×œ×™×“×”">
            <input type="text" id="mom-name" placeholder="×©× ×”××">
            <input type="text" id="dad-name" placeholder="×©× ×”××‘">
            <button class="btn-bar" style="background:var(--rose); color:white; justify-content:center;" onclick="Actions.saveProfile()">××ª×—×™×œ×™×! âœ¨</button>
        </div>
    </div>

    <div id="app-header" style="display:none; justify-content:space-between; align-items:center; padding:10px 0;">
        <h1 id="header-title" style="font-size:22px; color:var(--rose); margin:0; font-weight:800;">ZoharApp.</h1>
        <button onclick="Actions.toggleTheme()" style="background:none; border:none; font-size:20px;">ğŸŒ“</button>
    </div>

    <div id="scr-home" class="screen">
        <div class="summary-box">
            <div><span class="sum-val" id="sum-meals">0</span><span class="sum-lbl">××¨×•×—×•×ª</span></div>
            <div><span class="sum-val" id="sum-diapers">0</span><span class="sum-lbl">×—×™×ª×•×œ×™×</span></div>
            <div><span class="sum-val" id="sum-sleep">0</span><span class="sum-lbl">×©×¢×•×ª ×©×™× ×”</span></div>
        </div>

        <div class="bento-grid">
            <div class="bento-card" onclick="Navigation.show('scr-nursing')" style="border-right: 4px solid var(--rose)">
                <span class="card-icon">ğŸ¤±</span>
                <span class="card-title">×”× ×§×”</span>
                <span class="card-info" id="inf-nursing">-</span>
            </div>
            <div class="bento-card" onclick="Actions.addBottle()" style="border-right: 4px solid var(--blue)">
                <span class="card-icon">ğŸ¼</span>
                <span class="card-title">×‘×§×‘×•×§</span>
                <span class="card-info" id="inf-bottle">×ª×™×¢×•×“</span>
            </div>
            <div class="bento-card" onclick="Navigation.show('scr-diaper')" style="border-right: 4px solid var(--amber)">
                <span class="card-icon">âœ¨</span>
                <span class="card-title">×—×™×ª×•×œ</span>
                <span class="card-info" id="inf-diaper">-</span>
            </div>
            <div id="card-sleep" class="bento-card" onclick="Navigation.show('scr-sleep')" style="border-right: 4px solid var(--indigo)">
                <span class="card-icon">ğŸŒ™</span>
                <span class="card-title">×©×™× ×”</span>
                <span class="card-info" id="inf-sleep">×œ×™×œ×” ×˜×•×‘</span>
            </div>
            <div class="bento-card" onclick="Navigation.show('scr-measures')" style="border-right: 4px solid var(--indigo)">
                <span class="card-icon">ğŸ“ˆ</span>
                <span class="card-title">××“×“×™×</span>
            </div>
            <div class="bento-card" onclick="Navigation.show('scr-meds')" style="border-right: 4px solid var(--red)">
                <span class="card-icon">ğŸ’Š</span>
                <span class="card-title">×ª×¨×•×¤×•×ª</span>
            </div>
            <div class="bento-card wide" onclick="Actions.logSimple('×¨×—×¦×”', '×‘×•×¦×¢×” ×¨×—×¦×”')" style="border-right: 4px solid var(--cyan)">
                <div style="display:flex; align-items:center; gap:10px;">
                    <span class="card-icon" style="margin:0">ğŸ›</span>
                    <span class="card-title">×¨×—×¦×”</span>
                </div>
                <span style="opacity:0.3">â¯</span>
            </div>
        </div>

        <button class="btn-bar" onclick="Navigation.show('scr-calendar')">ğŸ“… ×™×•××Ÿ ×¤×¢×™×œ×•×ª <span>â¯</span></button>
        <div style="text-align:center; margin-top:15px;">
            <button onclick="Navigation.show('scr-settings')" style="background:none; border:none; color:#94a3b8; font-size:13px; text-decoration:underline;">âš™ï¸ ×”×’×“×¨×•×ª ×•×¤×¨×•×¤×™×œ</button>
        </div>
    </div>

    <div id="scr-nursing" class="screen">
        <h2 style="text-align:center">×”× ×§×”</h2>
        <div class="btn-bar" style="background:none; border:1px solid #ddd;">
            <div style="text-align:center; width:50%">×©×¢×”: <b id="last-meal-time">-</b></div>
            <div style="text-align:center; width:50%">×¦×“: <b id="last-side-info">-</b></div>
        </div>
        <div id="n-timer" class="timer">00:00</div>
        <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px;">
            <button id="n-R" class="btn-bar" style="justify-content:center; height:100px;" onclick="Actions.toggleNursing('×™××™×Ÿ')">×™××™×Ÿ</button>
            <button id="n-L" class="btn-bar" style="justify-content:center; height:100px;" onclick="Actions.toggleNursing('×©×××œ')">×©×××œ</button>
        </div>
        <button class="btn-bar" style="background:var(--green); color:white; margin-top:20px; justify-content:center;" onclick="Actions.finishNursing()">×¡×™×•× ×•×¢×“×›×•×Ÿ</button>
        <button class="btn-bar" style="justify-content:center; background:none;" onclick="Navigation.show('scr-home')">×—×–×¨×”</button>
    </div>

    <div id="scr-sleep" class="screen">
        <h2 style="text-align:center">××¢×§×‘ ×©×™× ×”</h2>
        <div id="s-timer" class="timer">00:00</div>
        <button id="s-toggle" class="btn-bar" style="justify-content:center; height:120px; background:var(--indigo); color:white;" onclick="Actions.toggleSleep()">×”×ª×—×œ×ª ×©×™× ×” ğŸŒ™</button>
        <button class="btn-bar" style="justify-content:center; background:none; margin-top:20px;" onclick="Navigation.show('scr-home')">×—×–×¨×”</button>
    </div>

    <div id="scr-diaper" class="screen">
        <h2 style="text-align:center">×—×™×ª×•×œ</h2>
        <button class="btn-bar" onclick="Actions.logSimple('×—×™×ª×•×œ','ğŸ’¦ ×¤×™×¤×™')">ğŸ’¦ ×¤×™×¤×™ <span>â¯</span></button>
        <button class="btn-bar" onclick="Actions.logSimple('×—×™×ª×•×œ','ğŸ’© ×§×§×™')">ğŸ’© ×§×§×™ <span>â¯</span></button>
        <button class="btn-bar" onclick="Actions.logSimple('×—×™×ª×•×œ','ğŸŒˆ ×’× ×•×’×')">ğŸŒˆ ×’× ×•×’× <span>â¯</span></button>
        <button class="btn-bar" style="justify-content:center; background:none;" onclick="Navigation.show('scr-home')">×‘×™×˜×•×œ</button>
    </div>

    <div id="scr-meds" class="screen">
        <h2 style="text-align:center">×ª×¨×•×¤×•×ª</h2>
        <input type="text" id="med-name" placeholder="×©× ×ª×¨×•×¤×”">
        <button class="btn-bar" style="background:var(--indigo); color:white; justify-content:center;" onclick="Actions.addMed()">×”×•×¡×£ ×ª×¨×•×¤×” +</button>
        <div id="med-list-container" style="margin-top:20px;"></div>
        <button class="btn-bar" style="justify-content:center; background:none;" onclick="Navigation.show('scr-home')">×—×–×¨×”</button>
    </div>

    <div id="scr-measures" class="screen">
        <h2 style="text-align:center">××“×“×™×</h2>
        <input type="number" id="m-weight" step="0.001" placeholder="××©×§×œ (×§×´×’)">
        <input type="number" id="m-height" step="0.1" placeholder="×’×•×‘×” (×¡×´×)">
        <button class="btn-bar" style="background:var(--indigo); color:white; justify-content:center;" onclick="Actions.saveMeasure()">×©××•×¨ ××“×“×™×</button>
        <canvas id="weightChart"></canvas>
        <canvas id="heightChart"></canvas>
        <button class="btn-bar" style="justify-content:center; background:none;" onclick="Navigation.show('scr-home')">×—×–×¨×”</button>
    </div>

    <div id="scr-calendar" class="screen">
        <div id="cal-grid" style="display:grid; grid-template-columns:repeat(7,1fr); gap:5px; margin:15px 0;"></div>
        <div id="day-logs-container"></div>
        <button class="btn-bar" style="justify-content:center; background:none;" onclick="Navigation.show('scr-home')">×—×–×¨×”</button>
    </div>

    <div id="scr-settings" class="screen">
        <h2 style="text-align:center">×¤×¨×•×¤×™×œ ×•×”×’×“×¨×•×ª</h2>
        <div id="profile-info" class="btn-bar" style="display:block; font-size:14px; background:rgba(251,113,133,0.1);"></div>
        <button class="btn-bar" style="background:var(--blue); color:white; justify-content:center;" onclick="window.print()">ğŸ“‹ ×”×›× ×ª ×“×•×— ×œ×¨×•×¤× (PDF)</button>
        <button class="btn-bar" style="background:var(--red); color:white; justify-content:center; margin-top:20px;" onclick="DataStore.clearAll()">âš ï¸ ××—×™×§×ª ×”×›×œ</button>
        <button class="btn-bar" style="justify-content:center; background:none;" onclick="Navigation.show('scr-home')">×—×–×¨×”</button>
    </div>

</div>

<script>
    const DataStore = {
        logs: [], meds: [], measures: [], profile: null, sleepStart: null,
        load() {
            this.logs = JSON.parse(localStorage.getItem('z_v15_logs')) || [];
            this.meds = JSON.parse(localStorage.getItem('z_v15_meds')) || [];
            this.measures = JSON.parse(localStorage.getItem('z_v15_measures')) || [];
            this.profile = JSON.parse(localStorage.getItem('z_v15_profile')) || null;
            this.sleepStart = parseInt(localStorage.getItem('z_sleepStart')) || null;
        },
        save() {
            localStorage.setItem('z_v15_logs', JSON.stringify(this.logs));
            localStorage.setItem('z_v15_meds', JSON.stringify(this.meds));
            localStorage.setItem('z_v15_measures', JSON.stringify(this.measures));
            localStorage.setItem('z_v15_profile', JSON.stringify(this.profile));
            if(this.sleepStart) localStorage.setItem('z_sleepStart', this.sleepStart); else localStorage.removeItem('z_sleepStart');
        },
        clearAll() { if(confirm("×œ××—×•×§ ×”×›×œ?")) { localStorage.clear(); location.reload(); } }
    };

    const Navigation = {
        show(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            if(id === 'scr-home') UI.updateDashboard();
            if(id === 'scr-calendar') UI.renderCalendar();
            if(id === 'scr-measures') UI.initCharts();
            if(id === 'scr-sleep') UI.initSleepView();
        }
    };

    const UI = {
        init() {
            if(!DataStore.profile) {
                Navigation.show('scr-onboarding');
            } else {
                document.getElementById('app-header').style.display = 'flex';
                document.getElementById('header-title').innerText = `${DataStore.profile.name}App.`;
                this.updateProfileDisplay();
                Navigation.show('scr-home');
            }
        },
        updateProfileDisplay() {
            if(!DataStore.profile) return;
            document.getElementById('profile-info').innerHTML = `
                <b>${DataStore.profile.name}</b> (${DataStore.profile.gender})<br>
                × ×•×œ×“/×” ×‘: ${DataStore.profile.dob}<br>
                ×”×•×¨×™×: ${DataStore.profile.mom} ×•-${DataStore.profile.dad}
            `;
        },
        updateDashboard() {
            const today = new Date().toLocaleDateString('en-GB');
            const todayLogs = DataStore.logs.filter(l => l.date === today);
            document.getElementById('sum-meals').innerText = todayLogs.filter(l => l.type === '×”× ×§×”' || l.type === '×‘×§×‘×•×§').length;
            document.getElementById('sum-diapers').innerText = todayLogs.filter(l => l.type === '×—×™×ª×•×œ').length;
            
            const lastM = DataStore.logs.find(l => l.type === '×”× ×§×”' || l.type === '×‘×§×‘×•×§');
            const lastD = DataStore.logs.find(l => l.type === '×—×™×ª×•×œ');
            document.getElementById('inf-nursing').innerText = lastM ? lastM.time : '-';
            document.getElementById('inf-diaper').innerText = lastD ? lastD.time : '-';

            const sCard = document.getElementById('card-sleep');
            if(DataStore.sleepStart) {
                sCard.classList.add('active-sleep');
                this.updateLiveSleep();
            } else {
                sCard.classList.remove('active-sleep');
                document.getElementById('inf-sleep').innerText = "×œ×™×œ×” ×˜×•×‘";
            }
        },
        updateLiveSleep() {
            if(!DataStore.sleepStart) return;
            const diff = Math.floor((Date.now() - DataStore.sleepStart) / 60000);
            document.getElementById('inf-sleep').innerText = `×™×©× ×”: ${diff} ×“×§'`;
        },
        initSleepView() {
            const btn = document.getElementById('s-toggle');
            if(DataStore.sleepStart) {
                btn.innerText = "×‘×•×§×¨ ×˜×•×‘ â˜€ï¸"; btn.style.background = "var(--amber)";
                if(window.sTimerInt) clearInterval(window.sTimerInt);
                window.sTimerInt = setInterval(() => {
                    const sec = Math.floor((Date.now() - DataStore.sleepStart) / 1000);
                    document.getElementById('s-timer').innerText = Math.floor(sec/60).toString().padStart(2,'0') + ":" + (sec%60).toString().padStart(2,'0');
                }, 1000);
            } else {
                btn.innerText = "×”×ª×—×œ×ª ×©×™× ×” ğŸŒ™"; btn.style.background = "var(--indigo)";
                document.getElementById('s-timer').innerText = "00:00";
                clearInterval(window.sTimerInt);
            }
        },
        renderCalendar(dateStr) {
            const selected = dateStr || new Date().toLocaleDateString('en-GB');
            const grid = document.getElementById('cal-grid'); grid.innerHTML = '';
            for(let i=1; i<=31; i++) {
                const div = document.createElement('div');
                div.style = `padding:8px; text-align:center; border-radius:10px; cursor:pointer; background:${i===15?'var(--rose)':'var(--card-bg)'}; border:1px solid #eee;`;
                div.innerText = i; grid.appendChild(div);
            }
            document.getElementById('day-logs-container').innerHTML = `<p style="text-align:center">×™×•××Ÿ ×¤×¢×™×œ×•×ª ×œ-${selected}</p>`;
        },
        showToast() { const t = document.getElementById('toast'); t.className = "show"; setTimeout(()=>t.className="", 3000); }
    };

    const Actions = {
        saveProfile() {
            const name = document.getElementById('baby-name').value;
            if(!name) return alert("×× × ×”×›× ×¡ ×©×");
            DataStore.profile = {
                name: name,
                gender: document.getElementById('baby-gender').value,
                dob: document.getElementById('baby-dob').value,
                mom: document.getElementById('mom-name').value,
                dad: document.getElementById('dad-name').value
            };
            DataStore.save();
            UI.init();
        },
        logSimple(type, detail) {
            DataStore.logs.unshift({ type, detail, time: new Date().toLocaleTimeString('he-IL',{hour:'2-digit', minute:'2-digit'}), ts: Date.now(), date: new Date().toLocaleDateString('en-GB') });
            DataStore.save(); UI.showToast(); Navigation.show('scr-home');
        },
        addBottle() { const ml = prompt("×›××•×ª ×‘×\"×œ:"); if(ml) this.logSimple('×‘×§×‘×•×§', ml + ' ×"×œ'); },
        toggleSleep() {
            if(!DataStore.sleepStart) { DataStore.sleepStart = Date.now(); DataStore.save(); UI.initSleepView(); }
            else {
                const diffMin = Math.round((Date.now()-DataStore.sleepStart)/60000);
                this.logSimple('×©×™× ×”', `××©×š: ${diffMin} ×“×§×•×ª`);
                DataStore.sleepStart = null; DataStore.save(); Navigation.show('scr-home');
            }
        },
        toggleTheme() { document.body.classList.toggle('night-mode'); }
    };

    DataStore.load();
    UI.init();
</script>
</body>
</html>


<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ZoharApp Pro v5</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Assistant:wght@400;700;800&display=swap');
        :root { --rose: #fb7185; --bg: #f8fafc; --card-bg: white; --text: #1e293b; --indigo: #6366f1; --amber: #f59e0b; --green: #10b981; --blue: #3b82f6; }
        body.night-mode { --bg: #0f172a; --card-bg: #1e293b; --text: #f1f5f9; }
        * { box-sizing: border-box; font-family: 'Assistant', sans-serif; -webkit-tap-highlight-color: transparent; }
        body { background-color: var(--bg); color: var(--text); margin: 0; padding: 0; transition: background 0.3s; line-height: 1.5; }
        .container { max-width: 500px; margin: 0 auto; padding: 15px; }
        
        .header { text-align: center; padding: 20px 0; }
        .logo { font-size: 28px; font-weight: 900; color: var(--rose); margin: 0; }
        
        .stat-card { background: var(--card-bg); padding: 15px; border-radius: 20px; text-align: center; box-shadow: 0 2px 8px rgba(0,0,0,0.06); margin-bottom: 10px; }
        .dashboard { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px; }
        
        .btn { width: 100%; background: var(--card-bg); border: none; padding: 18px; border-radius: 20px; margin-bottom: 12px; font-size: 18px; font-weight: 800; color: var(--text); cursor: pointer; border-bottom: 4px solid rgba(0,0,0,0.1); display: flex; justify-content: space-between; align-items: center; }
        .btn:active { transform: translateY(2px); border-bottom-width: 0; }
        
        .screen { display: none; animation: fadeIn 0.3s; }
        .screen.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .night-only { display: none; background: rgba(99, 102, 241, 0.15); padding: 15px; border-radius: 20px; margin-bottom: 15px; border: 2px dashed var(--indigo); }
        body.night-mode .night-only { display: block; }

        .timer { font-size: 60px; text-align: center; color: var(--rose); margin: 20px 0; font-family: monospace; font-weight: bold; }
        .nursing-active { background: var(--rose) !important; color: white !important; animation: pulse 2s infinite; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.8; } 100% { opacity: 1; } }

        .log-item { background: var(--card-bg); padding: 10px; border-radius: 12px; margin-bottom: 8px; border-right: 4px solid var(--rose); font-size: 14px; position: relative; }
        .del-btn { position: absolute; left: 10px; top: 10px; color: #ef4444; font-weight: bold; font-size: 12px; }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <h1 class="logo">ZoharApp Pro</h1>
        <div id="night-msg" style="display:none; color:var(--indigo); font-size:12px; font-weight:bold;">ğŸŒ™ ××¦×‘ ×œ×™×œ×” ×¤×¢×™×œ</div>
    </div>

    <div id="home-screen" class="screen active">
        <div class="night-only">
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                <button class="btn" style="background:var(--rose); color:white; justify-content:center; border:none;" onclick="quickAction('×”××›×œ×”')">ğŸ¤±/ğŸ¼ ××¨×•×—×”</button>
                <button class="btn" style="background:var(--amber); color:white; justify-content:center; border:none;" onclick="showView('diaper-screen')">âœ¨ ×—×™×ª×•×œ</button>
            </div>
        </div>

        <div class="dashboard">
            <div class="stat-card"><div style="font-size:11px; color:#94a3b8;">××¨×•×—×” ××—×¨×•× ×”</div><div id="dash-meal" style="font-size:20px; font-weight:800;">-</div></div>
            <div class="stat-card"><div style="font-size:11px; color:#94a3b8;">×—×™×ª×•×œ ××—×¨×•×Ÿ</div><div id="dash-diaper" style="font-size:20px; font-weight:800;">-</div></div>
        </div>

        <button class="btn" style="border-right:6px solid var(--rose)" onclick="showView('nursing-screen')">ğŸ¤± ×”× ×§×” <span>â¯</span></button>
        <button class="btn" style="border-right:6px solid var(--blue)" onclick="addBottle()">ğŸ¼ ×‘×§×‘×•×§ <span>â¯</span></button>
        <button class="btn" style="border-right:6px solid var(--amber)" onclick="showView('diaper-screen')">âœ¨ ×—×™×ª×•×œ <span>â¯</span></button>
        <button class="btn" style="border-right:6px solid var(--indigo)" onclick="showView('calendar-screen')">ğŸ“… ×™×•××Ÿ ×¤×¢×™×œ×•×ª <span>â¯</span></button>
        <button class="btn" onclick="toggleConfig()" id="config-btn">âš™ï¸ ××¦×‘: ×”× ×§×” + ×‘×§×‘×•×§</button>
    </div>

    <div id="nursing-screen" class="screen">
        <h2 style="text-align:center">×ª×™×¢×•×“ ×”× ×§×”</h2>
        <div id="nursing-timer" class="timer">00:00</div>
        <div style="display:grid; grid-template-columns:1fr 1fr; gap:15px;">
            <button id="nursing-R" class="btn" style="justify-content:center; height:100px;" onclick="toggleNursing('×™××™×Ÿ')">×™××™×Ÿ</button>
            <button id="nursing-L" class="btn" style="justify-content:center; height:100px;" onclick="toggleNursing('×©×××œ')">×©×××œ</button>
        </div>
        <button class="btn" style="margin-top:30px; justify-content:center; background:var(--green); color:white; border:none;" onclick="showView('home-screen')">×¡×™×•× ×•×¢×“×›×•×Ÿ âœ…</button>
    </div>

    <div id="diaper-screen" class="screen">
        <h2 style="text-align:center">××” ×”×™×” ×‘×—×™×ª×•×œ?</h2>
        <button class="btn" onclick="logAction('×—×™×ª×•×œ', 'ğŸ’¦ ×¤×™×¤×™')">ğŸ’¦ ×¤×™×¤×™</button>
        <button class="btn" onclick="logAction('×—×™×ª×•×œ', 'ğŸ’© ×§×§×™')">ğŸ’© ×§×§×™</button>
        <button class="btn" onclick="logAction('×—×™×ª×•×œ', 'ğŸŒˆ ×’× ×•×’×')">ğŸŒˆ ×’× ×•×’×</button>
        <button class="btn" style="justify-content:center; background:none; border:none; color:var(--rose)" onclick="showView('home-screen')">×‘×™×˜×•×œ</button>
    </div>

    <div id="calendar-screen" class="screen">
        <h2 style="text-align:center">×”×™×¡×˜×•×¨×™×” (×”×™×•×)</h2>
        <div id="log-list"></div>
        <button class="btn" style="margin-top:20px; justify-content:center;" onclick="showView('home-screen')">×—×–×¨×”</button>
    </div>
</div>

<script>
    let logs = [], config = {onlyBottle: false};

    function init() {
        try {
            logs = JSON.parse(localStorage.getItem('z_logs_v5')) || [];
            config = JSON.parse(localStorage.getItem('z_config_v5')) || {onlyBottle: false};
        } catch(e) { logs = []; }
        
        checkNightMode();
        updateDashboard();
        applyConfig();
        setInterval(checkNightMode, 30000);
    }

    function showView(id) {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        if(id === 'calendar-screen') renderLogs();
    }

    function checkNightMode() {
        const hour = new Date().getHours();
        const isNight = hour >= 23 || hour < 7;
        document.body.classList.toggle('night-mode', isNight);
        document.getElementById('night-msg').style.display = isNight ? 'block' : 'none';
    }

    function quickAction(type) {
        if(type === '×”××›×œ×”') {
            config.onlyBottle ? addBottle() : showView('nursing-screen');
        }
    }

    // --- ×œ×•×’×™×§×ª ×”× ×§×” ---
    let nActive = null, nStart = null, nInt = null;
    function toggleNursing(side) {
        if(nActive === side) {
            // ×¢×¦×™×¨×”
            clearInterval(nInt);
            const duration = Math.round((Date.now() - nStart) / 60000);
            saveNursing(side, duration);
            nActive = null;
            document.getElementById('nursing-R').classList.remove('nursing-active');
            document.getElementById('nursing-L').classList.remove('nursing-active');
            document.getElementById('nursing-timer').innerText = "00:00";
        } else {
            // ×”×ª×—×œ×”
            if(nActive) toggleNursing(nActive);
            nActive = side;
            nStart = Date.now();
            document.getElementById('nursing-' + (side === '×™××™×Ÿ' ? 'R' : 'L')).classList.add('nursing-active');
            nInt = setInterval(() => {
                const s = Math.floor((Date.now() - nStart) / 1000);
                const m = Math.floor(s/60).toString().padStart(2,'0');
                const sec = (s%60).toString().padStart(2,'0');
                document.getElementById('nursing-timer').innerText = `${m}:${sec}`;
            }, 1000);
        }
    }

    function saveNursing(side, mins) {
        const now = new Date();
        const time = now.getHours().toString().padStart(2,'0') + ":" + now.getMinutes().toString().padStart(2,'0');
        logs.unshift({ type: '×”× ×§×”', detail: `${side} (${mins} ×“×§')`, time, timestamp: Date.now() });
        sync();
    }

    function addBottle() {
        const ml = prompt("×›××•×ª ×\"×œ:");
        if(ml) logAction('×‘×§×‘×•×§', ml + ' ×"×œ');
    }

    function logAction(type, detail) {
        const now = new Date();
        const time = now.getHours().toString().padStart(2,'0') + ":" + now.getMinutes().toString().padStart(2,'0');
        logs.unshift({ type, detail, time, timestamp: Date.now() });
        sync();
        showView('home-screen');
    }

    function sync() {
        localStorage.setItem('z_logs_v5', JSON.stringify(logs));
        localStorage.setItem('z_config_v5', JSON.stringify(config));
        updateDashboard();
    }

    function updateDashboard() {
        const lastMeal = logs.find(l => l.type === '×”× ×§×”' || l.type === '×‘×§×‘×•×§');
        const lastDiaper = logs.find(l => l.type === '×—×™×ª×•×œ');
        document.getElementById('dash-meal').innerText = lastMeal ? lastMeal.time : '-';
        document.getElementById('dash-diaper').innerText = lastDiaper ? lastDiaper.time : '-';
    }

    function renderLogs() {
        const list = document.getElementById('log-list');
        list.innerHTML = logs.slice(0, 20).map((l, i) => `
            <div class="log-item">
                <span class="del-btn" onclick="deleteLog(${i})">××—×§</span>
                <strong>${l.time}</strong> - ${l.type}: ${l.detail}
            </div>
        `).join('');
    }

    function deleteLog(index) {
        if(confirm('×œ××—×•×§ ×¨×™×©×•× ×–×”?')) {
            logs.splice(index, 1);
            sync();
            renderLogs();
        }
    }

    function toggleConfig() {
        config.onlyBottle = !config.onlyBottle;
        sync();
        applyConfig();
    }

    function applyConfig() {
        document.getElementById('config-btn').innerText = config.onlyBottle ? "âš™ï¸ ××¦×‘: ×‘×§×‘×•×§ ×‘×œ×‘×“" : "âš™ï¸ ××¦×‘: ×”× ×§×” + ×‘×§×‘×•×§";
    }

    init();
</script>
</body>
</html>

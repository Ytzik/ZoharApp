<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZOHAR APP - Management System</title>
    <style>
        /* ==========================================
           UI LAYER: CSS & STYLING
           ========================================== */
        :root {
            --primary: #2c3e50;
            --accent: #3498db;
            --success: #27ae60;
            --bg: #f4f7f6;
            --text: #333;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            padding: 20px;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            padding: 20px 0;
            background: var(--primary);
            color: white;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .card {
            background: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: opacity 0.2s;
        }

        .btn-add { background-color: var(--success); color: white; }
        .btn-action { background-color: var(--accent); color: white; }

        .time-ago {
            font-size: 0.9em;
            color: #7f8c8d;
        }

        input {
            width: 100%;
            padding: 10px;
            margin-bottom: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            box-sizing: border-box;
        }
    </style>
</head>
<body>

   <div class="container">
    <header>
        <h1 onclick="Actions.switchScreen('main')">ZOHAR APP</h1>
        <p id="current-time"></p>
    </header>

    <nav class="nav-bar">
        <button onclick="Actions.switchScreen('main')">תרופות</button>
        <button onclick="Actions.switchScreen('history')">היסטוריה</button>
        <button onclick="Actions.switchScreen('settings')">הגדרות</button>
    </nav>

    <main id="app-content">
        </main>
</div>

        <div id="med-list">
            </div>
    </div>

    <script>
        /* ==========================================
           1. DATA LAYER (localStorage Management)
           ========================================== */
        const DataLayer = {
            DB_KEY: 'zohar_app_data',

            save(data) {
                localStorage.setItem(this.DB_KEY, JSON.stringify(data));
            },

            load() {
                const data = localStorage.getItem(this.DB_KEY);
                return data ? JSON.parse(data) : [];
            }
        };

        /* ==========================================
           2. LOGIC LAYER (Calculations & Processing)
           ========================================== */
        const LogicLayer = {
            formatTimeAgo(dateString) {
                if (!dateString) return "טרם נלקח";
                const now = new Date();
                const past = new Date(dateString);
                const diffMs = now - past;
                const diffMins = Math.floor(diffMs / 60000);

                if (diffMins < 1) return "ממש עכשיו";
                if (diffMins < 60) return `לפני ${diffMins} דקות`;
                
                const diffHours = Math.floor(diffMins / 60);
                if (diffHours < 24) return `לפני ${diffHours} שעות`;
                
                return `לפני ${Math.floor(diffHours / 24)} ימים`;
            },

            generateId() {
                return Date.now().toString(36) + Math.random().toString(36).substr(2);
            }
        };

        /* ==========================================
           3. UI LAYER (DOM Manipulation)
           ========================================== */
        const UILayer = {
            renderList() {
                const meds = DataLayer.load();
                const container = document.getElementById('med-list');
                container.innerHTML = '';

                meds.forEach(med => {
                    const card = document.createElement('div');
                    card.className = 'card';
                    card.innerHTML = `
                        <div>
                            <strong>${med.name}</strong><br>
                            <span class="time-ago">${LogicLayer.formatTimeAgo(med.lastTaken)}</span>
                        </div>
                        <button class="btn btn-action" onclick="Actions.markAsTaken('${med.id}')">בוצע</button>
                    `;
                    container.appendChild(card);
                });
            },

            updateClock() {
                const now = new Date();
                document.getElementById('current-time').innerText = now.toLocaleString('he-IL');
            },

            clearInput() {
                document.getElementById('med-name').value = '';
            }
        };

        /* ==========================================
           ACTIONS (Event Handling & Coordination)
           ========================================== */
        const Actions = {
            init() {
                UILayer.renderList();
                UILayer.updateClock();
                setInterval(() => UILayer.updateClock(), 1000);
                setInterval(() => UILayer.renderList(), 60000); // רענון זמנים כל דקה
            },

            addNewMed() {
                const nameInput = document.getElementById('med-name');
                if (!nameInput.value.trim()) return;

                const meds = DataLayer.load();
                meds.push({
                    id: LogicLayer.generateId(),
                    name: nameInput.value,
                    lastTaken: null
                });

                DataLayer.save(meds);
                UILayer.clearInput();
                UILayer.renderList();
            },

            markAsTaken(id) {
                const meds = DataLayer.load();
                const index = meds.findIndex(m => m.id === id);
                if (index !== -1) {
                    meds[index].lastTaken = new Date().toISOString();
                    DataLayer.save(meds);
                    UILayer.renderList();
                }
            }
        };

        // הפעלת האפליקציה בטעינה
        window.onload = Actions.init;

    </script>
</body>
</html>


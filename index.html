<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ZoharApp Pro</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Assistant:wght@400;700;800&display=swap');
        
        :root {
            --rose: #fb7185; --slate: #475569; --bg: #f8fafc; --green: #10b981;
            --blue: #3b82f6; --amber: #f59e0b; --purple: #a855f7; --indigo: #6366f1;
            --red: #ef4444; --card-bg: white; --text-main: #1e293b;
        }

        /* ××¦×‘ ×œ×™×œ×” - ×¨×§×¢×™× ×›×”×™× ×•×˜×§×¡×˜ ×‘×”×™×¨ */
        body.night-mode {
            --bg: #0f172a; --card-bg: #1e293b; --text-main: #f1f5f9; --slate: #cbd5e1;
        }

        * { box-sizing: border-box; font-family: 'Assistant', sans-serif; transition: background 0.3s, color 0.3s; }
        body { background-color: var(--bg); margin: 0; color: var(--text-main); line-height: 1.4; overflow-x: hidden; }
        
        .header { background: var(--card-bg); padding: 15px; text-align: center; border-radius: 0 0 25px 25px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .logo { font-size: 26px; font-weight: 900; color: var(--rose); margin: 0; }
        .container { max-width: 500px; margin: 0 auto; padding: 15px; }

        /* Dashboard */
        .dashboard { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 20px; }
        .stat-card { background: var(--card-bg); padding: 15px; border-radius: 20px; text-align: center; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .stat-full { grid-column: span 2; }
        .label { font-size: 11px; font-weight: bold; color: #94a3b8; text-transform: uppercase; }
        .value { font-size: 19px; font-weight: 800; margin-top: 5px; }

        /* Buttons */
        .btn { width: 100%; background: var(--card-bg); border: none; padding: 18px; border-radius: 20px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; font-size: 18px; font-weight: 800; cursor: pointer; color: var(--text-main); border-bottom: 4px solid rgba(0,0,0,0.1); }
        .btn-med-alert { background: var(--red) !important; color: white !important; animation: pulse 2s infinite; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.7; } 100% { opacity: 1; } }

        /* Night Mode Area */
        .night-only { display: none; margin-bottom: 20px; background: rgba(99, 102, 241, 0.1); border: 2px dashed var(--indigo); padding: 15px; border-radius: 20px; }
        body.night-mode .night-only { display: block; }

        .screen { display: none; }
        .screen.active { display: block; }

        /* Day View Grid */
        .day-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 4px; }
        .day-col { background: var(--card-bg); min-height: 350px; border-radius: 8px; padding: 4px; font-size: 9px; border: 1px solid rgba(0,0,0,0.05); }
        .log-entry { background: rgba(0,0,0,0.03); padding: 4px; margin-bottom: 4px; border-radius: 4px; position: relative; border-right: 2px solid var(--rose); }
        .del-btn { position: absolute; left: 0; top: 0; color: var(--red); cursor: pointer; padding: 2px; opacity: 0.3; }

        canvas { background: white; border-radius: 15px; padding: 10px; margin-top: 15px; width: 100% !important; }
        .timer { font-size: 60px; text-align: center; font-weight: bold; margin: 20px; color: var(--rose); font-family: monospace; }
        .nursing-active { background: var(--rose) !important; color: white !important; }
    </style>
</head>
<body class="night-mode"> <div class="header">
    <div id="night-indicator" style="font-size: 12px; font-weight: bold; color: var(--indigo); display: none;">ğŸŒ™ ××¦×‘ ×œ×™×œ×” ×¤×¢×™×œ</div>
    <h1 class="logo">ZoharApp Pro</h1>
    <div id="clock" style="font-size: 14px; opacity: 0.7;"></div>
</div>

<div class="container">
    <div id="home-screen" class="screen active">
        <div id="med-alert-banner" class="btn btn-med-alert" style="display:none; justify-content: center; margin-bottom: 15px;" onclick="showView('med-screen')">
            âš ï¸ ×ª×¨×•×¤×” ×œ× × ×œ×§×—×”! ×‘×“×§×™ ×›××Ÿ
        </div>

        <div class="night-only">
            <h3 style="margin-top:0; font-size: 16px;">×§×™×¦×•×¨×™ ×“×¨×š ×œ×œ×™×œ×”:</h3>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                <button class="btn" style="background:var(--rose); color:white; justify-content:center; border:none;" onclick="quickAction('×”××›×œ×”')">ğŸ¤±/ğŸ¼ ×”××›×œ×”</button>
                <button class="btn" style="background:var(--amber); color:white; justify-content:center; border:none;" onclick="showView('diaper-screen')">âœ¨ ×—×™×ª×•×œ</button>
            </div>
        </div>

        <div class="dashboard">
            <div class="stat-card">
                <div class="label">××¨×•×—×” ××—×¨×•× ×”</div>
                <div id="dash-meal" class="value">-</div>
            </div>
            <div class="stat-card">
                <div class="label">×—×™×ª×•×œ ××—×¨×•×Ÿ</div>
                <div id="dash-diaper" class="value">-</div>
            </div>
            <div class="stat-card stat-full" id="dash-meds-box" onclick="showView('med-screen')">
                <div class="label">×¡×˜×˜×•×¡ ×ª×¨×•×¤×•×ª</div>
                <div id="dash-meds" class="value">×˜×•×¢×Ÿ...</div>
            </div>
        </div>

        <div id="nursing-btn-container">
            <button class="btn" style="border-right: 6px solid var(--rose)" onclick="showView('nursing-screen')">ğŸ¤± ×”× ×§×” <span>â¯</span></button>
        </div>
        <button class="btn" style="border-right: 6px solid var(--blue)" onclick="addBottle()">ğŸ¼ ×‘×§×‘×•×§ <span>â¯</span></button>
        <button class="btn" style="border-right: 6px solid var(--amber)" onclick="showView('diaper-screen')">âœ¨ ×”×—×œ×¤×” <span>â¯</span></button>
        <button class="btn" style="border-right: 6px solid var(--indigo)" onclick="showView('measures-screen')">ğŸ“ˆ ××“×“×™× ×•×’×¨×¤×™× <span>â¯</span></button>
        <button class="btn" style="border-right: 6px solid var(--red)" id="main-med-btn" onclick="showView('med-screen')">ğŸ’Š ×ª×¨×•×¤×•×ª ×§×‘×•×¢×•×ª <span>â¯</span></button>
        
        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px; margin-top:10px;">
            <button class="btn" onclick="showView('calendar-screen')" style="font-size:14px; justify-content:center;">ğŸ“… ×™×•××Ÿ</button>
            <button class="btn" onclick="showView('settings-screen')" style="font-size:14px; justify-content:center;">âš™ï¸ ×”×’×“×¨×•×ª</button>
        </div>
    </div>

    <div id="nursing-screen" class="screen">
        <h2 style="text-align:center">×ª×™×¢×•×“ ×”× ×§×”</h2>
        <div id="nursing-timer" class="timer">00:00</div>
        <div style="display:grid; grid-template-columns:1fr 1fr; gap:15px;">
            <button id="nursing-R" class="btn" style="justify-content:center; height:100px; flex-direction:column;" onclick="toggleNursing('×™××™×Ÿ')"><span>×™××™×Ÿ</span><small id="last-R" style="font-size:10px; font-weight:normal;"></small></button>
            <button id="nursing-L" class="btn" style="justify-content:center; height:100px; flex-direction:column;" onclick="toggleNursing('×©×××œ')"><span>×©×××œ</span><small id="last-L" style="font-size:10px; font-weight:normal;"></small></button>
        </div>
        <button class="btn" style="background:var(--green); color:white; margin-top:30px; justify-content:center; border:none;" onclick="showView('home-screen')">×¡×™×•× ××¨×•×—×” âœ…</button>
    </div>

    <div id="measures-screen" class="screen">
        <h2>××“×“×™ ×”×ª×¤×ª×—×•×ª</h2>
        <div class="stat-card stat-full" style="margin-bottom:15px;">
            <div id="last-measure-info" style="font-weight:bold; line-height:1.6;">×˜×•×¢×Ÿ × ×ª×•× ×™×...</div>
        </div>
        <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px;">
            <button class="btn" style="font-size:14px; justify-content:center;" onclick="promptMeasure('weight')">âš–ï¸ ×¢×“×›×Ÿ ××©×§×œ</button>
            <button class="btn" style="font-size:14px; justify-content:center;" onclick="promptMeasure('height')">ğŸ“ ×¢×“×›×Ÿ ×’×•×‘×”</button>
        </div>
        <div style="background:white; border-radius:15px; margin-top:15px;">
            <canvas id="weightChart"></canvas>
        </div>
        <button class="btn" style="margin-top:20px; justify-content:center;" onclick="showView('home-screen')">×—×–×¨×”</button>
    </div>

    <div id="med-screen" class="screen">
        <h2>×ª×¨×•×¤×•×ª ×•×•×™×˜××™× ×™×</h2>
        <div id="med-not-taken-msg" style="display:none; margin-bottom:15px;" class="btn btn-med-alert"></div>
        <div id="med-list"></div>
        <div class="stat-card" style="margin-top:20px; text-align:right;">
            <h3>×”×’×“×¨×ª ×ª×¨×•×¤×” ×—×“×©×”</h3>
            <input type="text" id="new-med-name" placeholder="×©× ×”×ª×¨×•×¤×”">
            <select id="new-med-interval" style="width:100%; padding:12px; border-radius:10px; margin-bottom:10px;">
                <option value="1">×¤×¢× ×‘×™×•× (×›×œ 24 ×©×¢×•×ª)</option>
                <option value="0.5">×¤×¢××™×™× ×‘×™×•× (×›×œ 12 ×©×¢×•×ª)</option>
                <option value="7">×¤×¢× ×‘×©×‘×•×¢</option>
            </select>
            <button class="btn" style="background:var(--indigo); color:white; justify-content:center; border:none;" onclick="addMedication()">×”×•×¡×£ ×œ×¨×©×™××”</button>
        </div>
        <button class="btn" style="margin-top:20px; justify-content:center;" onclick="showView('home-screen')">×—×–×¨×”</button>
    </div>

    <div id="settings-screen" class="screen">
        <h2>×”×’×“×¨×•×ª ××¤×œ×™×§×¦×™×”</h2>
        <div class="stat-card">
            <p><strong>× ×™×”×•×œ ×”××›×œ×”:</strong></p>
            <button id="toggle-nursing-mode" class="btn" style="justify-content:center; border:1px solid #ddd;" onclick="toggleNursingInterface()">××¢×‘×¨ ×œ×‘×§×‘×•×§ ×‘×œ×‘×“</button>
            <p style="font-size:12px; color:#94a3b8; margin-top:10px;">×‘××¦×‘ ×‘×§×‘×•×§ ×‘×œ×‘×“, ×›×¤×ª×•×¨×™ ×”×”× ×§×” ×™×•×¡×ª×¨×• ××”××¡×š ×”×¨××©×™.</p>
        </div>
        <button class="btn" style="margin-top:20px; justify-content:center;" onclick="showView('home-screen')">×—×–×¨×”</button>
    </div>

    <div id="calendar-screen" class="screen">
        <h2 style="text-align:center">×™×•××Ÿ ×—×•×“×©×™</h2>
        <div id="calendar-grid" style="display:grid; grid-template-columns:repeat(7,1fr); gap:5px;"></div>
        <button class="btn" style="margin-top:20px; justify-content:center;" onclick="showView('home-screen')">×—×–×¨×”</button>
    </div>

    <div id="day-view" class="screen">
        <h2 id="day-title" style="text-align:center"></h2>
        <div class="day-grid">
            <div class="day-col"><div class="label">×”× ×§×”</div><div id="col-×”× ×§×”"></div></div>
            <div class="day-col"><div class="label">×‘×§×‘×•×§</div><div id="col-×‘×§×‘×•×§"></div></div>
            <div class="day-col"><div class="label">×—×™×ª×•×œ</div><div id="col-×—×™×ª×•×œ"></div></div>
            <div class="day-col"><div class="label">×ª×¨×•×¤×”</div><div id="col-×ª×¨×•×¤×”"></div></div>
            <div class="day-col"><div class="label">××—×¨</div><div id="col-××—×¨"></div></div>
        </div>
        <button class="btn" style="margin-top:20px; justify-content:center;" onclick="showView('calendar-screen')">×—×–×¨×” ×œ×™×•××Ÿ</button>
    </div>
    
    <div id="diaper-screen" class="screen">
        <h2 style="text-align:center">×ª×™×¢×•×“ ×—×™×ª×•×œ</h2>
        <button class="btn" onclick="logAction('×—×™×ª×•×œ', 'ğŸ’¦ ×¤×™×¤×™')">ğŸ’¦ ×¤×™×¤×™</button>
        <button class="btn" onclick="logAction('×—×™×ª×•×œ', 'ğŸ’© ×§×§×™')">ğŸ’© ×§×§×™</button>
        <button class="btn" onclick="logAction('×—×™×ª×•×œ', 'ğŸŒˆ ×©× ×™×”×')">ğŸŒˆ ×©× ×™×”×</button>
        <button class="btn" style="justify-content:center; background:none; border:none; color:var(--rose)" onclick="showView('home-screen')">×‘×™×˜×•×œ</button>
    </div>
</div>

<script>
    // State Management
    let logs = JSON.parse(localStorage.getItem('z_logs_v3') || '[]');
    let meds = JSON.parse(localStorage.getItem('z_meds_v3') || '[]');
    let measures = JSON.parse(localStorage.getItem('z_measures_v3') || '[]');
    let config = JSON.parse(localStorage.getItem('z_config_v3') || '{"onlyBottle": false}');
    
    let nursingActive = null;
    let nursingStart = null;
    let nursingTimerInt = null;

    function init() {
        checkNightMode();
        updateDashboard();
        applyConfig();
        setInterval(checkNightMode, 30000);
        setInterval(updateClock, 1000);
        updateClock();
        updateNursingHistoryLabels();
    }

    function updateClock() {
        const now = new Date();
        document.getElementById('clock').innerText = now.toLocaleDateString('he-IL') + " | " + now.toLocaleTimeString('he-IL', {hour:'2-digit', minute:'2-digit'});
    }

    function checkNightMode() {
        const hour = new Date().getHours();
        const isNight = hour >= 23 || hour < 7;
        document.body.classList.toggle('night-mode', isNight);
        document.getElementById('night-indicator').style.display = isNight ? 'block' : 'none';
    }

    function showView(id) {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        if(id === 'calendar-screen') renderCalendar();
        if(id === 'med-screen') renderMeds();
        if(id === 'measures-screen') { renderWeightChart(); updateMeasuresUI(); }
        if(id === 'nursing-screen') updateNursingHistoryLabels();
    }

    // --- NIGHT MODE QUICK ACTION FIX ---
    function quickAction(type) {
        if (type === '×”××›×œ×”') {
            if (config.onlyBottle) {
                addBottle();
            } else {
                showView('nursing-screen');
            }
        }
    }

    // --- Nursing Logic ---
    function toggleNursing(side) {
        const now = Date.now();
        if (nursingActive === side) {
            clearInterval(nursingTimerInt);
            const duration = Math.round((now - nursingStart) / 1000 / 60);
            saveNursing(side, duration);
            nursingActive = null;
            document.getElementById('nursing-' + side).classList.remove('nursing-active');
            document.getElementById('nursing-timer').innerText = "00:00";
            updateNursingHistoryLabels();
        } else {
            if(nursingActive) toggleNursing(nursingActive); 
            nursingActive = side;
            nursingStart = now;
            document.querySelectorAll('#nursing-R, #nursing-L').forEach(b => b.classList.remove('nursing-active'));
            document.getElementById('nursing-' + side).classList.add('nursing-active');
            nursingTimerInt = setInterval(() => {
                const sec = Math.floor((Date.now() - nursingStart) / 1000);
                document.getElementById('nursing-timer').innerText = 
                    Math.floor(sec/60).toString().padStart(2,'0') + ":" + (sec%60).toString().padStart(2,'0');
            }, 1000);
        }
    }

    function saveNursing(side, mins) {
        if(mins < 1 && !confirm("×”×”× ×§×” ×§×¦×¨×” ××“×§×”, ×œ×©××•×¨?")) return;
        const now = new Date();
        const lastLog = logs[0];
        const timeStr = now.getHours().toString().padStart(2,'0') + ":" + now.getMinutes().toString().padStart(2,'0');
        
        // Smart Merge within 30 mins
        if (lastLog && lastLog.type === '×”× ×§×”' && (Date.now() - lastLog.timestamp < 30 * 60000)) {
            lastLog.detail += ` + ${side} (${mins} ×“×§')`;
            lastLog.timestamp = Date.now(); // Keep it fresh
        } else {
            logs.unshift({
                type: '×”× ×§×”',
                detail: `${side} (${mins} ×“×§')`,
                timestamp: Date.now(),
                date: now.toLocaleDateString('he-IL').replace(/\//g, '.'),
                time: timeStr
            });
        }
        sync();
    }

    function updateNursingHistoryLabels() {
        const lastR = logs.find(l => l.type === '×”× ×§×”' && l.detail.includes('×™××™×Ÿ'));
        const lastL = logs.find(l => l.type === '×”× ×§×”' && l.detail.includes('×©×××œ'));
        document.getElementById('last-R').innerText = lastR ? `××—×¨×•×Ÿ: ${lastR.time}` : '××™×Ÿ ×ª×™×¢×•×“';
        document.getElementById('last-L').innerText = lastL ? `××—×¨×•×Ÿ: ${lastL.time}` : '××™×Ÿ ×ª×™×¢×•×“';
    }

    function addBottle() {
        const ml = prompt("×›××•×ª ×‘×"×œ:", "120");
        if(ml) logAction('×‘×§×‘×•×§', ml + ' ×"×œ');
    }

    // --- Medications ---
    function addMedication() {
        const name = document.getElementById('new-med-name').value;
        const interval = document.getElementById('new-med-interval').value;
        if(!name) return;
        meds.push({ name, interval: parseFloat(interval), lastTaken: 0 });
        sync();
        renderMeds();
        document.getElementById('new-med-name').value = '';
    }

    function takeMed(index) {
        meds[index].lastTaken = Date.now();
        logAction('×ª×¨×•×¤×”', meds[index].name);
        sync();
        renderMeds();
    }

    function renderMeds() {
        const list = document.getElementById('med-list');
        const alertMsg = document.getElementById('med-not-taken-msg');
        list.innerHTML = '';
        let missing = [];

        meds.forEach((m, i) => {
            const hoursSince = (Date.now() - m.lastTaken) / 3600000;
            const isLate = m.lastTaken === 0 || hoursSince > (m.interval * 24);
            if(isLate) missing.push(m.name);

            list.innerHTML += `
                <div class="stat-card" style="margin-bottom:10px; display:flex; justify-content:space-between; align-items:center;">
                    <div style="text-align:right">
                        <div style="font-weight:bold">${m.name}</div>
                        <div class="label">×›×œ ${m.interval >= 1 ? m.interval + ' ×™××™×' : (m.interval*24) + ' ×©×¢×•×ª'}</div>
                    </div>
                    <button class="btn ${isLate ? 'btn-med-alert' : ''}" style="width:auto; padding:10px 20px; margin:0; border:none;" onclick="takeMed(${i})">
                        ${isLate ? '×œ×ª×ª ×¢×›×©×™×•!' : '×‘×•×¦×¢'}
                    </button>
                </div>`;
        });

        const hasMissing = missing.length > 0;
        alertMsg.style.display = hasMissing ? 'block' : 'none';
        if(hasMissing) alertMsg.innerText = "×ª×–×›×•×¨×ª: " + missing.join(', ');
        
        document.getElementById('main-med-btn').classList.toggle('btn-med-alert', hasMissing);
        document.getElementById('med-alert-banner').style.display = hasMissing ? 'flex' : 'none';
    }

    // --- Measures & Chart ---
    function promptMeasure(type) {
        const label = type === 'weight' ? "××©×§×œ (×’×¨××™×):" : "×’×•×‘×” (×¡\"×):";
        const val = prompt(label);
        if(val) {
            measures.push({ type, value: parseFloat(val), timestamp: Date.now(), date: new Date().toLocaleDateString('he-IL') });
            sync();
            renderWeightChart();
            updateMeasuresUI();
        }
    }

    function updateMeasuresUI() {
        const lastW = [...measures].reverse().find(m => m.type === 'weight');
        const lastH = [...measures].reverse().find(m => m.type === 'height');
        document.getElementById('last-measure-info').innerHTML = `
            âš–ï¸ ××©×§×œ: ${lastW ? lastW.value + ' ×’×¨×' : '×˜×¨× × ××“×“'} | 
            ğŸ“ ×’×•×‘×”: ${lastH ? lastH.value + ' ×¡"×' : '×˜×¨× × ××“×“'}
            <div style="font-size:12px; color:var(--indigo); margin-top:5px;">×¢×“×›×•×Ÿ ××—×¨×•×Ÿ: ${lastW ? lastW.date : '-'}</div>`;
    }

    let myChart = null;
    function renderWeightChart() {
        const canvas = document.getElementById('weightChart');
        if(!canvas) return;
        const ctx = canvas.getContext('2d');
        const dataPoints = measures.filter(m => m.type === 'weight').slice(-7);
        if(myChart) myChart.destroy();
        myChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: dataPoints.map(d => d.date),
                datasets: [{ label: '××©×§×œ', data: dataPoints.map(d => d.value), borderColor: '#fb7185', backgroundColor: 'rgba(251, 113, 133, 0.1)', fill: true, tension: 0.3 }]
            },
            options: { plugins: { legend: { display: false } }, scales: { y: { beginAtZero: false } } }
        });
    }

    // --- Core Sync ---
    function logAction(type, detail) {
        const now = new Date();
        logs.unshift({
            type, detail, timestamp: Date.now(),
            date: now.toLocaleDateString('he-IL').replace(/\//g, '.'),
            time: now.getHours().toString().padStart(2,'0') + ":" + now.getMinutes().toString().padStart(2,'0')
        });
        sync();
        showView('home-screen');
    }

    function sync() {
        localStorage.setItem('z_logs_v3', JSON.stringify(logs));
        localStorage.setItem('z_meds_v3', JSON.stringify(meds));
        localStorage.setItem('z_measures_v3', JSON.stringify(measures));
        localStorage.setItem('z_config_v3', JSON.stringify(config));
        updateDashboard();
    }

    function updateDashboard() {
        const lastMeal = logs.find(l => l.type === '×”× ×§×”' || l.type === '×‘×§×‘×•×§');
        const lastDiaper = logs.find(l => l.type === '×—×™×ª×•×œ');
        document.getElementById('dash-meal').innerText = lastMeal ? lastMeal.time : '-';
        document.getElementById('dash-diaper').innerText = lastDiaper ? lastDiaper.time : '-';
        
        const missingCount = meds.filter(m => m.lastTaken === 0 || (Date.now() - m.lastTaken) / 3600000 > (m.interval * 24)).length;
        document.getElementById('dash-meds').innerText = missingCount > 0 ? `×—×¡×¨: ${missingCount}` : '×”×›×œ ×ª×§×™×Ÿ';
        document.getElementById('dash-meds-box').style.borderRight = missingCount > 0 ? '5px solid var(--red)' : 'none';
    }

    function toggleNursingInterface() {
        config.onlyBottle = !config.onlyBottle;
        sync();
        applyConfig();
    }

    function applyConfig() {
        document.getElementById('nursing-btn-container').style.display = config.onlyBottle ? 'none' : 'block';
        document.getElementById('toggle-nursing-mode').innerText = config.onlyBottle ? "×”×—×–×¨ ××¤×©×¨×•×ª ×”× ×§×”" : "××¢×‘×¨ ×œ×‘×§×‘×•×§ ×‘×œ×‘×“";
    }

    function renderCalendar() {
        const grid = document.getElementById('calendar-grid');
        grid.innerHTML = '';
        const now = new Date();
        const days = new Date(now.getFullYear(), now.getMonth() + 1, 0).getDate();
        for(let i=1; i<=days; i++) {
            const dateStr = `${i}.${now.getMonth()+1}.${now.getFullYear()}`;
            const day = document.createElement('div');
            day.className = 'stat-card';
            day.style.cursor = 'pointer';
            day.innerText = i;
            if(dateStr === now.toLocaleDateString('he-IL').replace(/\//g,'.')) day.style.border = '2px solid var(--rose)';
            day.onclick = () => showDay(dateStr);
            grid.appendChild(day);
        }
    }

    function showDay(date) {
        document.getElementById('day-title').innerText = date;
        const types = ['×”× ×§×”', '×‘×§×‘×•×§', '×—×™×ª×•×œ', '×ª×¨×•×¤×”', '××—×¨'];
        types.forEach(t => document.getElementById('col-' + t).innerHTML = '');
        
        logs.filter(l => l.date === date).forEach(l => {
            const col = types.includes(l.type) ? l.type : '××—×¨';
            document.getElementById('col-' + col).innerHTML += `
                <div class="log-entry">
                    <span class="del-btn" onclick="deleteLog(${l.timestamp})">âœ•</span>
                    <b>${l.time}</b><br>${l.detail}
                </div>`;
        });
        showView('day-view');
    }

    function deleteLog(ts) {
        if(confirm('×œ××—×•×§ ×œ×¦××™×ª×•×ª?')) {
            logs = logs.filter(l => l.timestamp !== ts);
            sync();
            showDay(document.getElementById('day-title').innerText);
        }
    }

    init();
</script>
</body>
</html>





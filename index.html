<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ZoharApp Pro v19</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Assistant:wght@400;600;800&display=swap');
        :root {
            --rose: #fb7185; --bg: #f8fafc; --card-bg: white; --text: #1e293b;
            --indigo: #6366f1; --amber: #f59e0b; --green: #10b981; --blue: #3b82f6; --red: #ef4444;
        }
        body { background-color: var(--bg); color: var(--text); margin: 0; font-family: 'Assistant', sans-serif; }
        .container { max-width: 450px; margin: 0 auto; padding: 15px; }
        .screen { display: none; } .screen.active { display: block; }

        /* Custom Modals (×‘××§×•× ×”×•×“×¢×•×ª ×“×¤×“×¤×Ÿ) */
        .z-modal { display: none; position: fixed; z-index: 9000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); align-items: center; justify-content: center; }
        .z-modal-content { background: white; padding: 25px; border-radius: 25px; width: 85%; text-align: center; color: #1e293b; }

        /* Dashboard Items */
        .bento-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        .bento-card { background: white; border-radius: 20px; padding: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); cursor: pointer; border-bottom: 4px solid #eee; }
        .btn-bar { width: 100%; padding: 16px; border-radius: 15px; border: none; font-weight: 800; cursor: pointer; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; background: white; border-bottom: 3px solid #ddd; }
        input, select { width: 100%; padding: 14px; margin-bottom: 10px; border: 1px solid #ddd; border-radius: 12px; }

        /* Print Report Style (××•×¡×ª×¨ ×‘××¡×š, ××•×¤×™×¢ ×‘×”×“×¤×¡×”) */
        #doctor-report-area { display: none; direction: rtl; padding: 40px; }
        @media print {
            body * { display: none !important; }
            #doctor-report-area { display: block !important; }
            #doctor-report-area * { display: block !important; }
            .report-table { width: 100%; border-collapse: collapse; margin-top: 20px; }
            .report-table td, .report-table th { border: 1px solid #000; padding: 8px; text-align: right; }
        }
    </style>
</head>
<body>

<div id="z-modal-bottle" class="z-modal">
    <div class="z-modal-content">
        <h2 style="color:var(--blue); margin-top:0;">ğŸ¼ ×›××” ×"×œ ××›×œ× ×•?</h2>
        <input type="number" id="input-bottle-ml" placeholder="×”×›× ×¡ ×›××•×ª ×‘××´×œ (×œ×“×•×’××” 120)" autofocus>
        <button class="btn-bar" style="background:var(--blue); color:white; justify-content:center;" onclick="Actions.saveBottle()">×©××•×¨</button>
        <button style="background:none; border:none; color:gray;" onclick="document.getElementById('z-modal-bottle').style.display='none'">×‘×™×˜×•×œ</button>
    </div>
</div>

<div class="container" id="main-ui">
    <div id="scr-onboarding" class="screen">
        <h1 style="color:var(--rose); text-align:center;">× ×¢×™× ×œ×”×›×™×¨! âœ¨</h1>
        <input type="text" id="reg-name" placeholder="×©× ×”×ª×™× ×•×§/×ª">
        <input type="text" id="reg-lname" placeholder="×©× ××©×¤×—×”">
        <label>×ª××¨×™×š ×œ×™×“×”:</label>
        <input type="date" id="reg-dob">
        <input type="text" id="reg-mom" placeholder="×©× ×”××">
        <input type="text" id="reg-dad" placeholder="×©× ×”××‘">
        <button class="btn-bar" style="background:var(--rose); color:white; justify-content:center;" onclick="Actions.saveProfile()">×”×ª×—×œ ×©×™××•×©</button>
    </div>

    <div id="app-content" style="display:none;">
        <h1 id="dynamic-title" style="color:var(--rose); font-size:22px;">×”×™×•× ×©×œ...</h1>

        <div id="scr-home" class="screen active">
            <div class="bento-grid">
                <div class="bento-card" onclick="Navigation.show('scr-nursing')">ğŸ¤± <b>×”× ×§×”</b></div>
                <div class="bento-card" onclick="document.getElementById('z-modal-bottle').style.display='flex'">ğŸ¼ <b>×‘×§×‘×•×§</b></div>
                <div class="bento-card" onclick="Navigation.show('scr-diaper')">âœ¨ <b>×—×™×ª×•×œ</b></div>
                <div class="bento-card" onclick="Navigation.show('scr-meds')">ğŸ’Š <b>×ª×¨×•×¤×•×ª</b></div>
                <div class="bento-card" onclick="Navigation.show('scr-measures')">ğŸ“ˆ <b>××“×“×™×</b></div>
                <div class="bento-card" onclick="Navigation.show('scr-calendar')">ğŸ“… <b>×™×•××Ÿ</b></div>
            </div>
            <button class="btn-bar" style="background:var(--blue); color:white; justify-content:center; margin-top:20px;" onclick="Actions.printReport()">ğŸ“‹ ×”×¤×§ ×“×•×— PDF ×œ×¨×•×¤×</button>
        </div>

        <div id="scr-nursing" class="screen">
            <h2 style="text-align:center">ğŸ¤± ×”× ×§×”</h2>
            <div id="n-timer" style="font-size:50px; text-align:center; font-family:monospace;">00:00</div>
            <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px;">
                <button id="n-R" class="btn-bar" onclick="Actions.toggleNursing('×™××™×Ÿ')">×™××™×Ÿ</button>
                <button id="n-L" class="btn-bar" onclick="Actions.toggleNursing('×©×××œ')">×©×××œ</button>
            </div>
            <button class="btn-bar" style="background:var(--green); color:white; justify-content:center;" onclick="Actions.finishNursing()">×¡×™×™× ××¨×•×—×”</button>
            <button class="btn-bar" onclick="Navigation.show('scr-home')">×—×–×¨×”</button>
        </div>

        <div id="scr-meds" class="screen">
            <h2>ğŸ’Š × ×™×”×•×œ ×ª×¨×•×¤×•×ª</h2>
            <input type="text" id="m-name" placeholder="×©× ×”×ª×¨×•×¤×”">
            <input type="text" id="m-dose" placeholder="××™× ×•×Ÿ">
            <select id="m-int">
                <option value="×¤×¢× ×‘×™×•×">×¤×¢× ×‘×™×•×</option>
                <option value="×›×œ 4 ×©×¢×•×ª">×›×œ 4 ×©×¢×•×ª</option>
                <option value="×›×œ 6 ×©×¢×•×ª">×›×œ 6 ×©×¢×•×ª</option>
                <option value="×›×œ 8 ×©×¢×•×ª">×›×œ 8 ×©×¢×•×ª</option>
                <option value="×›×œ 12 ×©×¢×•×ª">×›×œ 12 ×©×¢×•×ª</option>
            </select>
            <button class="btn-bar" style="background:var(--indigo); color:white; justify-content:center;" onclick="Actions.addMed()">×”×•×¡×£ ×ª×¨×•×¤×”</button>
            <div id="med-list"></div>
            <button class="btn-bar" onclick="Navigation.show('scr-home')">×—×–×¨×”</button>
        </div>

        <div id="scr-measures" class="screen">
            <h2>ğŸ“ˆ ××“×“×™ ×’×“×™×œ×”</h2>
            <input type="number" id="ms-w" step="0.01" placeholder="××©×§×œ (×§×´×’)">
            <input type="number" id="ms-h" step="0.1" placeholder="×’×•×‘×” (×¡×´×)">
            <button class="btn-bar" style="background:var(--green); color:white; justify-content:center;" onclick="Actions.saveMeasure()">×©××•×¨ ××“×“</button>
            <canvas id="chartW"></canvas>
            <button class="btn-bar" onclick="Navigation.show('scr-home')">×—×–×¨×”</button>
        </div>

        <div id="scr-calendar" class="screen">
            <h2>ğŸ“… ×™×•××Ÿ ×¤×¢×™×œ×•×ª</h2>
            <div id="cal-list"></div>
            <button class="btn-bar" onclick="Navigation.show('scr-home')">×—×–×¨×”</button>
        </div>
        
        <div id="scr-diaper" class="screen">
            <h2>âœ¨ ×—×™×ª×•×œ</h2>
            <button class="btn-bar" onclick="Actions.logSimple('×—×™×ª×•×œ','ğŸ’¦ ×¤×™×¤×™')">ğŸ’¦ ×¤×™×¤×™</button>
            <button class="btn-bar" onclick="Actions.logSimple('×—×™×ª×•×œ','ğŸ’© ×§×§×™')">ğŸ’© ×§×§×™</button>
            <button class="btn-bar" onclick="Actions.logSimple('×—×™×ª×•×œ','ğŸŒˆ ×’× ×•×’×')">ğŸŒˆ ×’× ×•×’×</button>
            <button class="btn-bar" onclick="Navigation.show('scr-home')">×—×–×¨×”</button>
        </div>
    </div>
</div>

<div id="doctor-report-area"></div>

<script>
    const Data = {
        logs: [], meds: [], measures: [], profile: null,
        load() {
            this.logs = JSON.parse(localStorage.getItem('z_v19_logs')) || [];
            this.meds = JSON.parse(localStorage.getItem('z_v19_meds')) || [];
            this.measures = JSON.parse(localStorage.getItem('z_v19_meas')) || [];
            this.profile = JSON.parse(localStorage.getItem('z_v19_prof')) || null;
        },
        save() {
            localStorage.setItem('z_v19_logs', JSON.stringify(this.logs));
            localStorage.setItem('z_v19_meds', JSON.stringify(this.meds));
            localStorage.setItem('z_v19_meas', JSON.stringify(this.measures));
            localStorage.setItem('z_v19_prof', JSON.stringify(this.profile));
        }
    };

    const Navigation = {
        show(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            if(id === 'scr-calendar') UI.renderCalendar();
            if(id === 'scr-meds') UI.renderMeds();
        }
    };

    const UI = {
        init() {
            Data.load();
            if(!Data.profile) Navigation.show('scr-onboarding');
            else {
                document.getElementById('app-content').style.display = 'block';
                document.getElementById('dynamic-title').innerText = `×”×™×•× ×©×œ ${Data.profile.name} ${Data.profile.lname}`;
                Navigation.show('scr-home');
            }
        },
        renderMeds() {
            document.getElementById('med-list').innerHTML = Data.meds.map(m => `
                <div class="btn-bar"><div><b>${m.name}</b> (${m.dose})<br><small>${m.interval}</small></div>
                <button style="background:var(--green); color:white; border:none; padding:10px; border-radius:10px;" onclick="Actions.logSimple('×ª×¨×•×¤×”','${m.name}')">× ×˜×™×œ×”</button></div>
            `).join('');
        },
        renderCalendar() {
            document.getElementById('cal-list').innerHTML = Data.logs.slice(0,20).map(l => `
                <div class="btn-bar"><b>${l.time}</b> | ${l.type}: ${l.detail}</div>
            `).join('');
        }
    };

    let nSide, nStart, nInt, nDurs = {R:0, L:0};
    const Actions = {
        saveProfile() {
            Data.profile = { 
                name: document.getElementById('reg-name').value, 
                lname: document.getElementById('reg-lname').value,
                dob: document.getElementById('reg-dob').value,
                mom: document.getElementById('reg-mom').value, dad: document.getElementById('reg-dad').value
            };
            Data.save(); UI.init();
        },
        logSimple(type, detail) {
            Data.logs.unshift({ type, detail, time: new Date().toLocaleTimeString('he-IL',{hour:'2-digit',minute:'2-digit'}), date: new Date().toLocaleDateString('en-GB'), ts: Date.now() });
            Data.save(); Navigation.show('scr-home');
        },
        saveBottle() {
            const ml = document.getElementById('input-bottle-ml').value;
            if(ml) {
                this.logSimple('×‘×§×‘×•×§', ml + ' ×"×œ');
                document.getElementById('z-modal-bottle').style.display = 'none';
                document.getElementById('input-bottle-ml').value = '';
            }
        },
        addMed() {
            const name = document.getElementById('m-name');
            const dose = document.getElementById('m-dose');
            const interval = document.getElementById('m-int');
            Data.meds.push({ name: name.value, dose: dose.value, interval: interval.value });
            Data.save();
            // × ×™×§×•×™ ×©×“×•×ª ×œ××—×¨ ×”×•×¡×¤×”
            name.value = ''; dose.value = '';
            UI.renderMeds();
        },
        saveMeasure() {
            const w = document.getElementById('ms-w').value;
            const h = document.getElementById('ms-h').value;
            Data.measures.push({ w, h, date: new Date().toLocaleDateString('en-GB') });
            Data.save(); Navigation.show('scr-home');
        },
        toggleNursing(side) {
            if(nSide === side) { clearInterval(nInt); nDurs[side==='×™××™×Ÿ'?'R':'L'] += Math.round((Date.now()-nStart)/1000); nSide=null; }
            else { nSide=side; nStart=Date.now(); nInt=setInterval(() => {
                const sec = Math.floor((Date.now()-nStart)/1000) + nDurs[side==='×™××™×Ÿ'?'R':'L'];
                document.getElementById('n-timer').innerText = Math.floor(sec/60).toString().padStart(2,'0')+":"+(sec%60).toString().padStart(2,'0');
            },1000); }
        },
        finishNursing() {
            this.logSimple('×”× ×§×”', `×™××™×Ÿ: ${Math.floor(nDurs.R/60)} ×“×§', ×©×××œ: ${Math.floor(nDurs.L/60)} ×“×§'`);
            nDurs={R:0,L:0}; clearInterval(nInt);
        },
        printReport() {
            const p = Data.profile;
            let pee = 0, poop = 0, bottleSum = 0, bottleCount = 0;
            Data.logs.forEach(l => {
                if(l.type === '×—×™×ª×•×œ') {
                    if(l.detail.includes('×¤×™×¤×™')) pee++;
                    else if(l.detail.includes('×§×§×™')) poop++;
                    else { pee++; poop++; }
                }
                if(l.type === '×‘×§×‘×•×§') {
                    const ml = parseInt(l.detail);
                    if(!isNaN(ml)) { bottleSum += ml; bottleCount++; }
                }
            });
            const lastW = Data.measures.length ? Data.measures[Data.measures.length-1].w : '-';
            const lastH = Data.measures.length ? Data.measures[Data.measures.length-1].h : '-';

            const html = `
                <h1 style="text-align:center">×“×•×— ×¨×¤×•××™ - ZoharApp</h1>
                <p><b>×©× ×”×™×œ×“:</b> ${p.name} ${p.lname} | <b>×ª××¨×™×š ×œ×™×“×”:</b> ${p.dob}</p>
                <p><b>×”×•×¨×™×:</b> ${p.mom}, ${p.dad}</p>
                <hr>
                <h3>×¡×˜×˜×™×¡×˜×™×§×ª ×”×–× ×” ×•×—×™×ª×•×œ×™× (× ×›×•×Ÿ ×œ×”×™×•×):</h3>
                <table class="report-table">
                    <tr><th>××“×“</th><th>×¢×¨×š</th></tr>
                    <tr><td>×—×™×ª×•×œ×™ ×¤×™×¤×™</td><td>${pee}</td></tr>
                    <tr><td>×—×™×ª×•×œ×™ ×§×§×™</td><td>${poop}</td></tr>
                    <tr><td>×××•×¦×¢ ××¨×•×—×ª ×‘×§×‘×•×§</td><td>${bottleCount > 0 ? Math.round(bottleSum/bottleCount) : 0} ×"×œ</td></tr>
                    <tr><td>××©×§×œ ××—×¨×•×Ÿ</td><td>${lastW} ×§"×’</td></tr>
                    <tr><td>×’×•×‘×” ××—×¨×•×Ÿ</td><td>${lastH} ×¡"×</td></tr>
                </table>
                <h3>×ª×¨×•×¤×•×ª ×•×˜×™×¤×•×œ×™×:</h3>
                <table class="report-table">
                    <tr><th>×ª×¨×•×¤×”</th><th>××™× ×•×Ÿ</th><th>××™× ×˜×¨×•×•×œ</th></tr>
                    ${Data.meds.map(m => `<tr><td>${m.name}</td><td>${m.dose}</td><td>${m.interval}</td></tr>`).join('')}
                </table>
            `;
            document.getElementById('doctor-report-area').innerHTML = html;
            window.print();
        }
    };

    UI.init();
</script>
</body>
</html>

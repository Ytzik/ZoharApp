<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ZoharApp Professional v23</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Assistant:wght@400;600;800&display=swap');
        :root { --rose: #fb7185; --blue: #3b82f6; --green: #10b981; --red: #ef4444; --amber: #f59e0b; --indigo: #6366f1; --bg: #f8fafc; }
        * { box-sizing: border-box; font-family: 'Assistant', sans-serif; }
        body { background: var(--bg); margin: 0; padding: 15px; color: #1e293b; }
        .screen { display: none; max-width: 500px; margin: 0 auto; }
        .active { display: block; }
        .card { background: white; padding: 15px; border-radius: 18px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); margin-bottom: 12px; }
        .btn-bar { width: 100%; padding: 16px; margin: 8px 0; border-radius: 15px; border: none; font-weight: 800; cursor: pointer; display: flex; justify-content: space-between; align-items: center; background: white; border-bottom: 4px solid #ddd; font-size: 16px; }
        .timer { font-size: 55px; text-align: center; margin: 20px 0; font-family: monospace; font-weight: 800; color: var(--rose); }
        .nursing-active { background: var(--red) !important; color: white !important; border: 3px solid black !important; animation: pulse 2s infinite; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.7; } 100% { opacity: 1; } }
        .info-box { background: #e2e8f0; padding: 10px; border-radius: 12px; margin-bottom: 15px; font-weight: bold; text-align: center; display: flex; justify-content: space-around; }
        input, select { width: 100%; padding: 14px; margin: 6px 0; border: 1px solid #ddd; border-radius: 12px; font-size: 16px; }
        .today-highlight { background: var(--amber) !important; color: black !important; font-weight: 800; }
        
        @media print {
            body * { display: none !important; }
            #print-report { display: block !important; direction: rtl; padding: 40px; }
        }
    </style>
</head>
<body>

<div id="app">
    <div id="scr-reg" class="screen">
        <h1 style="text-align:center; color:var(--rose)">×”×’×“×¨×ª ×¤×¨×•×¤×™×œ ğŸ‘¶</h1>
        <div class="card">
            <input type="text" id="reg-name" placeholder="×©× ×”×ª×™× ×•×§/×ª">
            <input type="text" id="reg-lname" placeholder="×©× ××©×¤×—×”">
            <input type="date" id="reg-dob">
            <input type="text" id="reg-mom" placeholder="×©× ×”××">
            <input type="text" id="reg-dad" placeholder="×©× ×”××‘">
            <button class="btn-bar" style="background:var(--rose); color:white; justify-content:center;" onclick="Actions.saveProfile()">×©××•×¨ ×•×”××©×š</button>
        </div>
    </div>

    <div id="scr-home" class="screen">
        <h2 id="welcome-title" style="margin-bottom:5px;">×©×œ×•×</h2>
        <div class="info-box">
            <div id="sum-feed">×”××›×œ×”: -</div>
            <div id="sum-diaper">×—×™×ª×•×œ×™×: 0</div>
        </div>
        
        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:12px;">
            <div class="card" onclick="Navigation.go('scr-nursing')" style="border-right: 5px solid var(--rose)">ğŸ¤± <b>×”× ×§×”</b><br><small id="home-nursing">-</small></div>
            <div class="card" onclick="Actions.askBottle()" style="border-right: 5px solid var(--blue)">ğŸ¼ <b>×‘×§×‘×•×§</b><br><small>×¨×™×©×•× ××”×™×¨</small></div>
            <div class="card" onclick="Navigation.go('scr-diaper')" style="border-right: 5px solid var(--amber)">âœ¨ <b>×—×™×ª×•×œ</b><br><small id="home-diaper">-</small></div>
            <div id="card-sleep" class="card" onclick="Navigation.go('scr-sleep')" style="border-right: 5px solid var(--indigo)">ğŸŒ™ <b>×©×™× ×”</b><br><small id="home-sleep">×œ×™×œ×” ×˜×•×‘</small></div>
            <div class="card" onclick="Navigation.go('scr-meds')" style="border-right: 5px solid var(--red)">ğŸ’Š <b>×ª×¨×•×¤×•×ª</b><br><small>× ×™×”×•×œ ×•×‘×§×¨×”</small></div>
            <div class="card" onclick="Navigation.go('scr-meas')" style="border-right: 5px solid var(--green)">ğŸ“ˆ <b>××“×“×™×</b><br><small>××©×§×œ ×•×’×•×‘×”</small></div>
        </div>
        
        <button class="btn-bar" style="margin-top:15px;" onclick="Navigation.go('scr-cal')">ğŸ“… ×™×•××Ÿ ×¤×¢×™×œ×•×ª ××œ×</button>
        <button class="btn-bar" style="background:var(--blue); color:white; justify-content:center;" onclick="Actions.printReport()">ğŸ“‹ ×”×¤×§ ×“×•×— PDF ×œ×¨×•×¤×</button>
    </div>

    <div id="scr-nursing" class="screen">
        <button class="btn-bar" onclick="Navigation.go('scr-home')">â¯ ×—×–×¨×”</button>
        <div class="card" style="text-align:center;">
            <p id="n-last-info" style="font-weight:bold; color:var(--rose);">-</p>
            <div id="n-timer" class="timer">00:00</div>
            <div style="display:flex; gap:10px;">
                <button id="btn-R" class="btn-bar" style="height:100px; justify-content:center;" onclick="Actions.nursingSide('×™××™×Ÿ')">×™××™×Ÿ</button>
                <button id="btn-L" class="btn-bar" style="height:100px; justify-content:center;" onclick="Actions.nursingSide('×©×××œ')">×©×××œ</button>
            </div>
            <button class="btn-bar" style="background:var(--green); color:white; justify-content:center; margin-top:20px;" onclick="Actions.finishNursing()">×¡×™×•× ×•×¢×“×›×•×Ÿ</button>
        </div>
    </div>

    <div id="scr-sleep" class="screen">
        <button class="btn-bar" onclick="Navigation.go('scr-home')">â¯ ×—×–×¨×”</button>
        <div class="card">
            <div id="s-timer" class="timer">00:00</div>
            <button id="s-btn" class="btn-bar" style="height:120px; justify-content:center; background:var(--indigo); color:white;" onclick="Actions.toggleSleep()">×”×ª×—×œ×ª ×©×™× ×”</button>
        </div>
    </div>

    <div id="scr-meds" class="screen">
        <button class="btn-bar" onclick="Navigation.go('scr-home')">â¯ ×—×–×¨×”</button>
        <div class="card">
            <input type="text" id="m-name" placeholder="×©× ×”×ª×¨×•×¤×”">
            <input type="text" id="m-dose" placeholder="××™× ×•×Ÿ">
            <select id="m-type" onchange="document.getElementById('m-val-box').style.display=(this.value==='daily'?'none':'block')">
                <option value="hours">×›×œ X ×©×¢×•×ª</option>
                <option value="daily">×¤×¢× ×‘×™×•×</option>
                <option value="days">×›×œ X ×™××™×</option>
            </select>
            <div id="m-val-box"><input type="number" id="m-val" placeholder="××¡×¤×¨ (×©×¢×•×ª/×™××™×)"></div>
            <button class="btn-bar" style="background:var(--red); color:white; justify-content:center;" onclick="Actions.addMed()">×”×•×¡×£ ×ª×¨×•×¤×”</button>
        </div>
        <div id="med-list"></div>
    </div>

    <div id="scr-meas" class="screen">
        <button class="btn-bar" onclick="Navigation.go('scr-home')">â¯ ×—×–×¨×”</button>
        <div class="card">
            <p id="ms-text" style="font-weight:800; color:var(--indigo); text-align:center;">×˜×•×¢×Ÿ ××“×“×™×...</p>
            <div style="display:flex; gap:10px;">
                <input type="number" id="ms-w" step="0.001" placeholder="××©×§×œ (×§×´×’)">
                <input type="number" id="ms-h" placeholder="×’×•×‘×” (×¡×´×)">
            </div>
            <button class="btn-bar" style="background:var(--green); color:white; justify-content:center;" onclick="Actions.saveMeas()">×©××•×¨ ××“×“</button>
        </div>
        <canvas id="chartW" style="margin-bottom:20px;"></canvas>
        <canvas id="chartH"></canvas>
    </div>

    <div id="scr-cal" class="screen">
        <button class="btn-bar" onclick="Navigation.go('scr-home')">â¯ ×—×–×¨×”</button>
        <div id="cal-grid" style="display:grid; grid-template-columns: repeat(7, 1fr); gap:5px; margin-bottom:15px;"></div>
        <div id="cal-list"></div>
    </div>

    <div id="scr-diaper" class="screen">
        <button class="btn-bar" onclick="Navigation.go('scr-home')">â¯ ×—×–×¨×”</button>
        <button class="btn-bar" onclick="Actions.log('×—×™×ª×•×œ', 'ğŸ’¦ ×¤×™×¤×™')">ğŸ’¦ ×¤×™×¤×™</button>
        <button class="btn-bar" onclick="Actions.log('×—×™×ª×•×œ', 'ğŸ’© ×§×§×™')">ğŸ’© ×§×§×™</button>
        <button class="btn-bar" onclick="Actions.log('×—×™×ª×•×œ', 'ğŸŒˆ ×’× ×•×’×')">ğŸŒˆ ×’× ×•×’×</button>
    </div>
</div>

<div id="print-report" style="display:none;"></div>

<script>
    const Data = {
        logs: JSON.parse(localStorage.getItem('z_logs')) || [],
        meds: JSON.parse(localStorage.getItem('z_meds')) || [],
        meas: JSON.parse(localStorage.getItem('z_meas')) || [],
        prof: JSON.parse(localStorage.getItem('z_prof')) || null,
        sleep: localStorage.getItem('z_sleep') || null,
        lastN: JSON.parse(localStorage.getItem('z_lastN')) || {time:'-', side:'-'},
        
        save() {
            localStorage.setItem('z_logs', JSON.stringify(this.logs));
            localStorage.setItem('z_meds', JSON.stringify(this.meds));
            localStorage.setItem('z_meas', JSON.stringify(this.meas));
            localStorage.setItem('z_prof', JSON.stringify(this.prof));
            localStorage.setItem('z_lastN', JSON.stringify(this.lastN));
            if(this.sleep) localStorage.setItem('z_sleep', this.sleep); else localStorage.removeItem('z_sleep');
        }
    };

    const Navigation = {
        go(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            window.scrollTo(0,0);
            if(id === 'scr-home') UI.home();
            if(id === 'scr-nursing') UI.nursing();
            if(id === 'scr-meds') UI.meds();
            if(id === 'scr-meas') UI.meas();
            if(id === 'scr-cal') UI.cal();
            if(id === 'scr-sleep') UI.sleep();
        }
    };

    const UI = {
        home() {
            if(!Data.prof) return Navigation.go('scr-reg');
            document.getElementById('welcome-title').innerText = `×”×™×•× ×©×œ ${Data.prof.name} ${Data.prof.lname}`;
            const today = new Date().toLocaleDateString('en-GB');
            const todayLogs = Data.logs.filter(l => l.date === today);
            
            document.getElementById('home-nursing').innerText = `${Data.lastN.time} (${Data.lastN.side})`;
            document.getElementById('sum-diaper').innerText = `×—×™×ª×•×œ×™×: ${todayLogs.filter(l=>l.type==='×—×™×ª×•×œ').length}`;
            const lastF = Data.logs.find(l => l.type === '×”× ×§×”' || l.type === '×‘×§×‘×•×§');
            document.getElementById('sum-feed').innerText = `×”××›×œ×”: ${lastF ? lastF.time : '-'}`;
            
            const sCard = document.getElementById('card-sleep');
            if(Data.sleep) { 
                sCard.style.background = 'var(--indigo)'; sCard.style.color = 'white';
                document.getElementById('home-sleep').innerText = "×™×©× ×” ×›×¢×ª...";
            } else { 
                sCard.style.background = 'white'; sCard.style.color = 'inherit';
                document.getElementById('home-sleep').innerText = "×œ×™×œ×” ×˜×•×‘";
            }
        },
        nursing() {
            document.getElementById('n-last-info').innerText = `××—×¨×•× ×”: ${Data.lastN.time} (×¦×“ ${Data.lastN.side})`;
        },
        meds() {
            document.getElementById('med-list').innerHTML = Data.meds.map(m => `
                <div class="btn-bar">
                    <div><b>${m.name}</b> (${m.dose})<br><small>${m.text}</small></div>
                    <button class="btn-bar" style="width:auto; background:var(--green); color:white; margin:0;" onclick="Actions.takeMed(${m.id})">× ×˜×™×œ×”</button>
                </div>
            `).join('');
        },
        meas() {
            const last = Data.meas[Data.meas.length-1];
            document.getElementById('ms-text').innerText = last ? `××©×§×œ: ${last.w} ×§"×’ | ×’×•×‘×”: ${last.h} ×¡"× (${last.fullDate})` : "×˜×¨× ×”×•×–× ×• ××“×“×™×";
            if(window.chW) window.chW.destroy(); if(window.chH) window.chH.destroy();
            window.chW = new Chart(document.getElementById('chartW'), {type:'line', data:{labels:Data.meas.map(m=>m.date), datasets:[{label:'××©×§×œ', data:Data.meas.map(m=>m.w), borderColor:'blue'}]}});
            window.chH = new Chart(document.getElementById('chartH'), {type:'line', data:{labels:Data.meas.map(m=>m.date), datasets:[{label:'×’×•×‘×”', data:Data.meas.map(m=>m.h), borderColor:'green'}]}});
        },
        cal(specificDate) {
            const sel = specificDate || new Date().toLocaleDateString('en-GB');
            const grid = document.getElementById('cal-grid'); grid.innerHTML = '';
            const todayNum = new Date().getDate();
            for(let i=1; i<=31; i++) {
                const dStr = i.toString().padStart(2,'0') + "/" + (new Date().getMonth()+1).toString().padStart(2,'0') + "/" + new Date().getFullYear();
                const isToday = i === todayNum;
                grid.innerHTML += `<div onclick="UI.cal('${dStr}')" class="${isToday?'today-highlight':''}" style="padding:8px; text-align:center; border:1px solid #ddd; border-radius:8px; cursor:pointer; background:${sel===dStr?'#333':'white'}; color:${sel===dStr?'white':'inherit'}">${i}</div>`;
            }
            document.getElementById('cal-list').innerHTML = `<h3>${sel}</h3>` + Data.logs.filter(l => l.date === sel).map(l => `<div class="btn-bar"><b>${l.time}</b> ${l.type}: ${l.detail}</div>`).join('') || "××™×Ÿ × ×ª×•× ×™×";
        },
        sleep() {
            const btn = document.getElementById('s-btn');
            if(Data.sleep) {
                btn.innerText = "×‘×•×§×¨ ×˜×•×‘! â˜€ï¸"; btn.style.background = "var(--amber)";
                if(window.sInt) clearInterval(window.sInt);
                window.sInt = setInterval(() => {
                    const diff = Math.floor((Date.now() - Data.sleep)/1000);
                    document.getElementById('s-timer').innerText = Math.floor(diff/60).toString().padStart(2,'0') + ":" + (diff%60).toString().padStart(2,'0');
                }, 1000);
            } else {
                btn.innerText = "×”×ª×—×œ×ª ×©×™× ×” ğŸŒ™"; btn.style.background = "var(--indigo)";
                document.getElementById('s-timer').innerText = "00:00"; clearInterval(window.sInt);
            }
        }
    };

    let nSide = null, nStart = 0, nInt = null, nDurs = {R:0, L:0};
    const Actions = {
        saveProfile() {
            const n = document.getElementById('reg-name').value, l = document.getElementById('reg-lname').value;
            if(!n || !l) return alert("×©× ×•×©× ××©×¤×—×” ×—×•×‘×”");
            Data.prof = { name:n, lname:l, dob:document.getElementById('reg-dob').value, mom:document.getElementById('reg-mom').value, dad:document.getElementById('reg-dad').value };
            Data.save(); Navigation.go('scr-home');
        },
        log(type, detail, ts) {
            const now = ts ? new Date(ts) : new Date();
            Data.logs.unshift({ type, detail, time: now.toLocaleTimeString('he-IL',{hour:'2-digit',minute:'2-digit'}), date: now.toLocaleDateString('en-GB'), ts: now.getTime() });
            Data.save(); Navigation.go('scr-home');
        },
        askBottle() {
            const ml = prompt("×›××” ×\"×œ ××›×œ× ×•?");
            if(ml) this.log('×‘×§×‘×•×§', ml + ' ×"×œ');
        },
        nursingSide(side) {
            const btn = document.getElementById(side==='×™××™×Ÿ'?'btn-R':'btn-L');
            if(nSide === side) {
                nDurs[side==='×™××™×Ÿ'?'R':'L'] += Math.floor((Date.now()-nStart)/1000);
                nSide = null; btn.classList.remove('nursing-active'); clearInterval(nInt);
            } else {
                if(nSide) this.nursingSide(nSide);
                nSide = side; nStart = Date.now();
                btn.classList.add('nursing-active');
                nInt = setInterval(() => {
                    const cur = nDurs[side==='×™××™×Ÿ'?'R':'L'] + Math.floor((Date.now()-nStart)/1000);
                    document.getElementById('n-timer').innerText = Math.floor(cur/60).toString().padStart(2,'0') + ":" + (cur%60).toString().padStart(2,'0');
                }, 1000);
            }
        },
        finishNursing() {
            const totalSec = nDurs.R + nDurs.L + (nSide ? Math.floor((Date.now()-nStart)/1000) : 0);
            if(totalSec < 10) return alert("×”×–××Ÿ ×§×¦×¨ ××“×™ ×œ×¨×™×©×•× ××¨×•×—×”");
            if(nSide) this.nursingSide(nSide);
            const detail = `×™××™×Ÿ: ${Math.floor(nDurs.R/60)} ×“×§', ×©×××œ: ${Math.floor(nDurs.L/60)} ×“×§'`;
            Data.lastN = { time: new Date().toLocaleTimeString('he-IL',{hour:'2-digit',minute:'2-digit'}), side: nDurs.R >= nDurs.L ? '×™××™×Ÿ' : '×©×××œ' };
            this.log('×”× ×§×”', detail);
            nDurs = {R:0, L:0}; document.getElementById('n-timer').innerText = "00:00";
        },
        toggleSleep() {
            if(!Data.sleep) { Data.sleep = Date.now(); }
            else { const diff = Math.floor((Date.now()-Data.sleep)/60000); this.log('×©×™× ×”', `${diff} ×“×§×•×ª`); Data.sleep = null; }
            Data.save(); UI.sleep();
        },
        addMed() {
            const n = document.getElementById('m-name'), d = document.getElementById('m-dose'), t = document.getElementById('m-type'), v = document.getElementById('m-val');
            if(!n.value) return;
            let ms = 0, txt = "";
            if(t.value === 'daily') { ms = 86400000; txt = "×¤×¢× ×‘×™×•×"; }
            else if(t.value === 'hours') { ms = v.value * 3600000; txt = `×›×œ ${v.value} ×©×¢×•×ª`; }
            else { ms = v.value * 86400000; txt = `×›×œ ${v.value} ×™××™×`; }
            Data.meds.push({ id:Date.now(), name:n.value, dose:d.value, interval:ms, text:txt });
            Data.save();
            n.value=''; d.value=''; v.value=''; UI.meds();
        },
        takeMed(id) {
            const med = Data.meds.find(m => m.id === id);
            const last = Data.logs.find(l => l.type === '×ª×¨×•×¤×”' && l.detail.includes(med.name));
            if(last && (Date.now() - last.ts < med.interval)) {
                if(!confirm(`××–×”×¨×”: ×”×ª×¨×•×¤×” ${med.name} × ×™×ª× ×” ×œ×¤× ×™ ×¤×—×•×ª ×-${med.text}. ×œ×”××©×™×š?`)) return;
            }
            this.log('×ª×¨×•×¤×”', `${med.name} (${med.dose})`);
        },
        saveMeas() {
            const w = document.getElementById('ms-w').value, h = document.getElementById('ms-h').value;
            if(!w) return;
            Data.meas.push({ w, h, date: new Date().toLocaleDateString('en-GB').slice(0,5), fullDate: new Date().toLocaleDateString('en-GB'), ts: Date.now() });
            Data.save(); Navigation.go('scr-home');
        },
        printReport() {
            const p = Data.prof;
            const today = new Date().toLocaleDateString('en-GB');
            const logs = Data.logs.filter(l => l.date === today);
            
            let pee=0, poop=0, bSum=0, bCount=0, nMin=0, nCount=0;
            logs.forEach(l => {
                if(l.type === '×—×™×ª×•×œ') {
                    if(l.detail.includes('×¤×™×¤×™')) pee++;
                    if(l.detail.includes('×§×§×™')) poop++;
                    if(l.detail.includes('×’× ×•×’×')) { pee++; poop++; }
                }
                if(l.type === '×‘×§×‘×•×§') { const v = parseInt(l.detail); if(v){ bSum += v; bCount++; } }
                if(l.type === '×”× ×§×”') {
                    nCount++;
                    const m = l.detail.match(/\d+/g);
                    if(m) nMin += (parseInt(m[0]) + parseInt(m[1]));
                }
            });

            const html = `
                <div style="direction:rtl; text-align:right; font-family:Arial;">
                    <h1>×“×•×— ×¨×¤×•××™ - ${p.name} ${p.lname}</h1>
                    <p><b>×ª××¨×™×š ×œ×™×“×”:</b> ${p.dob} | <b>×”×•×¨×™×:</b> ${p.mom}, ${p.dad}</p>
                    <hr>
                    <h3>×¡×™×›×•× ×œ×™×•× ${today}:</h3>
                    <ul>
                        <li><b>×—×™×ª×•×œ×™×:</b> ${pee} ×¤×™×¤×™, ${poop} ×§×§×™.</li>
                        <li><b>×”× ×§×”:</b> ${nCount} ××¨×•×—×•×ª, ×××•×¦×¢ ×©×œ ${nCount ? Math.round(nMin/nCount) : 0} ×“×§×•×ª ×œ××¨×•×—×”.</li>
                        <li><b>×‘×§×‘×•×§:</b> ${bCount} ×‘×§×‘×•×§×™×, ×××•×¦×¢ ×©×œ ${bCount ? Math.round(bSum/bCount) : 0} ×"×œ.</li>
                        <li><b>××“×“×™× ××—×¨×•× ×™×:</b> ××©×§×œ ${Data.meas.length ? Data.meas[Data.meas.length-1].w : '-'} ×§"×’, ×’×•×‘×” ${Data.meas.length ? Data.meas[Data.meas.length-1].h : '-'} ×¡"×.</li>
                    </ul>
                    <h3>×ª×¨×•×¤×•×ª:</h3>
                    <table border="1" style="width:100%; border-collapse:collapse;">
                        <tr><th>×©×</th><th>××™× ×•×Ÿ</th><th>×ª×“×™×¨×•×ª</th></tr>
                        ${Data.meds.map(m=>`<tr><td>${m.name}</td><td>${m.dose}</td><td>${m.text}</td></tr>`).join('')}
                    </table>
                </div>
            `;
            document.getElementById('print-report').innerHTML = html;
            window.print();
        }
    };

    Navigation.go('scr-home');
</script>
</body>
</html>

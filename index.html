<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ZoharApp v26 - Professional</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Assistant:wght@300;400;600;800&display=swap');
        :root {
            --rose: #fb7185; --blue: #3b82f6; --green: #10b981; --red: #ef4444; 
            --amber: #f59e0b; --indigo: #6366f1; --bg: #f8fafc;
        }
        * { box-sizing: border-box; font-family: 'Assistant', sans-serif; }
        body { background: var(--bg); margin: 0; padding: 15px; color: #0f172a; direction: rtl; }
        
        /* Modals */
        #custom-modal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.7); z-index: 9999; align-items: center; justify-content: center;
        }
        .modal-content {
            background: white; width: 90%; max-width: 400px; padding: 25px; 
            border-radius: 24px; text-align: center;
        }

        .screen { display: none; max-width: 480px; margin: 0 auto; }
        .active { display: block; }
        .card { background: white; padding: 18px; border-radius: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); margin-bottom: 15px; border: 1px solid #e2e8f0; }
        .btn { width: 100%; padding: 16px; border-radius: 16px; border: none; font-weight: 800; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px; }
        .btn-secondary { background: white; border: 2px solid #e2e8f0; color: #475569; }
        
        .timer { font-size: 48px; font-weight: 800; color: var(--rose); margin: 15px 0; font-family: monospace; }
        .bath-done { background: #06b6d4 !important; color: white !important; }
        
        input, select { width: 100%; padding: 14px; margin: 8px 0; border: 1px solid #cbd5e1; border-radius: 12px; }

        @media print {
            body * { display: none !important; }
            #print-area { display: block !important; direction: rtl; }
            table { width: 100%; border-collapse: collapse; }
            th, td { border: 1px solid #ddd; padding: 8px; text-align: right; }
        }
    </style>
</head>
<body>

    <div id="custom-modal">
        <div class="modal-content" id="modal-inner"></div>
    </div>

    <div id="scr-reg" class="screen">
        <h2 style="text-align:center;">×”×’×“×¨×ª ×¤×¨×•×¤×™×œ ğŸ‘¶</h2>
        <div class="card">
            <input type="text" id="reg-name" placeholder="×©× ×”×ª×™× ×•×§/×ª">
            <input type="text" id="reg-lname" placeholder="×©× ××©×¤×—×”">
            <select id="reg-gender">
                <option value="">××™×Ÿ ×”×ª×™× ×•×§/×ª</option>
                <option value="×–×›×¨">×–×›×¨ ğŸ‘¦</option>
                <option value="× ×§×‘×”">× ×§×‘×” ğŸ‘§</option>
            </select>
            <input type="date" id="reg-dob">
            <button class="btn" style="background:var(--rose); color:white;" onclick="Core.initProfile()">×©××•×¨ ×•×”××©×š</button>
        </div>
    </div>

    <div id="scr-home" class="screen">
        <h2 id="home-hello">×©×œ×•×</h2>
        
        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:12px;">
            <div class="card" onclick="Nav.to('scr-nursing')" style="border-right: 5px solid var(--rose)">ğŸ¤± <b>×”× ×§×”</b><br><small id="home-nurs">-</small></div>
            <div class="card" onclick="Core.openBottleModal()" style="border-right: 5px solid var(--blue)">ğŸ¼ <b>×‘×§×‘×•×§</b><br><small id="home-bott">-</small></div>
            <div class="card" onclick="Nav.to('scr-diaper')" style="border-right: 5px solid var(--amber)">âœ¨ <b>×—×™×ª×•×œ</b><br><small id="home-diap">0 ×”×™×•×</small></div>
            <div class="card" id="card-sleep" onclick="Nav.to('scr-sleep')" style="border-right: 5px solid var(--indigo)">ğŸŒ™ <b>×©×™× ×”</b><br><small id="home-slee">×× ×•×—×”</small></div>
            <div class="card" onclick="Nav.to('scr-meds')" style="border-right: 5px solid var(--red)">ğŸ’Š <b>×ª×¨×•×¤×•×ª</b></div>
            <div class="card" onclick="Nav.to('scr-meas')" style="border-right: 5px solid var(--green)">ğŸ“ˆ <b>××“×“×™×</b></div>
            <button id="btn-bath" class="btn card" style="grid-column: span 2; border-right: 5px solid #06b6d4;" onclick="Core.doBath()">ğŸ› <b>×¨×—×¦×”</b></button>
        </div>

        <button class="btn btn-secondary" style="margin-top:20px;" onclick="Nav.to('scr-cal')">ğŸ“… ×™×•××Ÿ ×¤×¢×™×œ×•×ª</button>
        <button class="btn" style="background:var(--blue); color:white; margin-top:10px;" onclick="Core.generateReport()">ğŸ“‹ ×”×¤×§ ×“×•×— ×œ×¨×•×¤×</button>
        
        <div style="display:flex; gap:10px; margin-top:20px;">
            <button class="btn btn-secondary" style="font-size:12px;" onclick="Core.exportData()">ğŸ“¤ ×’×™×‘×•×™</button>
            <button class="btn btn-secondary" style="font-size:12px;" onclick="Core.importData()">ğŸ“¥ ×©×—×–×•×¨</button>
        </div>
    </div>

    <div id="scr-meas" class="screen">
        <button class="btn btn-secondary" onclick="Nav.to('scr-home')">â¯ ×—×–×¨×”</button>
        <div class="card">
            <p id="meas-last-text" style="font-weight:800; text-align:center; color:var(--indigo);"></p>
            <div style="display:flex; gap:10px;">
                <input type="number" id="ms-w" step="0.001" placeholder="××©×§×œ">
                <input type="number" id="ms-h" placeholder="×’×•×‘×”">
            </div>
            <button class="btn" style="background:var(--green); color:white;" onclick="Core.saveMeas()">×©××•×¨ ××“×“</button>
        </div>
        <canvas id="chW"></canvas>
        <canvas id="chH" style="margin-top:20px;"></canvas>
    </div>

    <div id="scr-nursing" class="screen">
        <button class="btn btn-secondary" onclick="Nav.to('scr-home')">â¯ ×—×–×¨×”</button>
        <div class="card" style="text-align:center;">
            <div id="n-timer" class="timer">00:00</div>
            <div style="display:flex; gap:10px;">
                <button id="btn-R" class="btn btn-secondary" style="height:80px;" onclick="Core.nursingSide('×™××™×Ÿ')">×™××™×Ÿ</button>
                <button id="btn-L" class="btn btn-secondary" style="height:80px;" onclick="Core.nursingSide('×©×××œ')">×©×××œ</button>
            </div>
            <button class="btn" style="background:var(--green); color:white; margin-top:20px;" onclick="Core.nursingFinish()">×¡×™×•×</button>
        </div>
    </div>

    <div id="scr-meds" class="screen">
        <button class="btn btn-secondary" onclick="Nav.to('scr-home')">â¯ ×—×–×¨×”</button>
        <div class="card">
            <input type="text" id="m-name" placeholder="×©× ×”×ª×¨×•×¤×”">
            <input type="text" id="m-dose" placeholder="××™× ×•×Ÿ">
            <select id="m-type"><option value="hours">×›×œ X ×©×¢×•×ª</option><option value="daily">×¤×¢× ×‘×™×•×</option></select>
            <input type="number" id="m-val" placeholder="××¡×¤×¨ (×©×¢×•×ª/×™××™×)">
            <button class="btn" style="background:var(--red); color:white;" onclick="Core.addMed()">×”×•×¡×£ ×ª×¨×•×¤×”</button>
        </div>
        <div id="med-list"></div>
    </div>

    <div id="scr-cal" class="screen">
        <button class="btn btn-secondary" onclick="Nav.to('scr-home')">â¯ ×—×–×¨×”</button>
        <div id="cal-list"></div>
    </div>

    <div id="scr-diaper" class="screen">
        <button class="btn btn-secondary" onclick="Nav.to('scr-home')">â¯ ×—×–×¨×”</button>
        <button class="btn card" onclick="Core.log('×—×™×ª×•×œ', 'ğŸ’¦ ×¤×™×¤×™')">ğŸ’¦ ×¤×™×¤×™</button>
        <button class="btn card" onclick="Core.log('×—×™×ª×•×œ', 'ğŸ’© ×§×§×™')">ğŸ’© ×§×§×™</button>
    </div>

    <div id="scr-sleep" class="screen">
        <button class="btn btn-secondary" onclick="Nav.to('scr-home')">â¯ ×—×–×¨×”</button>
        <div id="s-timer" class="timer" style="text-align:center;">00:00</div>
        <button id="s-btn" class="btn" style="background:var(--indigo); color:white;" onclick="Core.toggleSleep()">×”×ª×—×œ×ª ×©×™× ×”</button>
    </div>

    <div id="print-area" style="display:none;"></div>

<script>
    const DB = {
        logs: JSON.parse(localStorage.getItem('z_logs')) || [],
        meds: JSON.parse(localStorage.getItem('z_meds')) || [],
        meas: JSON.parse(localStorage.getItem('z_meas')) || [],
        prof: JSON.parse(localStorage.getItem('z_prof')) || null,
        lastBath: localStorage.getItem('z_bath') || 0,
        save() {
            localStorage.setItem('z_logs', JSON.stringify(this.logs));
            localStorage.setItem('z_meds', JSON.stringify(this.meds));
            localStorage.setItem('z_meas', JSON.stringify(this.meas));
            localStorage.setItem('z_prof', JSON.stringify(this.prof));
            localStorage.setItem('z_bath', this.lastBath);
        }
    };

    const Nav = {
        to(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            if(id === 'scr-home') UI.home();
            if(id === 'scr-meas') UI.meas();
            if(id === 'scr-meds') UI.meds();
            if(id === 'scr-cal') UI.cal();
        }
    };

    const UI = {
        modal(html) {
            document.getElementById('modal-inner').innerHTML = html;
            document.getElementById('custom-modal').style.display = 'flex';
        },
        close() { document.getElementById('custom-modal').style.display = 'none'; },
        home() {
            if(!DB.prof) return Nav.to('scr-reg');
            document.getElementById('home-hello').innerText = `×”×™×•× ×©×œ ${DB.prof.name}`;
            const today = new Date().toLocaleDateString('en-GB');
            const tLogs = DB.logs.filter(l => l.date === today);
            document.getElementById('home-diap').innerText = tLogs.filter(l=>l.type==='×—×™×ª×•×œ').length + " ×”×™×•×";
            
            // ×‘×“×™×§×ª ×¨×—×¦×” (24 ×©×¢×•×ª)
            const btnBath = document.getElementById('btn-bath');
            const diffBath = Date.now() - DB.lastBath;
            if(diffBath < 86400000) { btnBath.classList.add('bath-done'); } 
            else { btnBath.classList.remove('bath-done'); }
        },
        meas() {
            const last = DB.meas[DB.meas.length-1];
            document.getElementById('meas-last-text').innerText = last ? `××“×™×“×” ××—×¨×•× ×”: ${last.w} ×§"×’ ×‘×ª××¨×™×š ${last.date}` : "×˜×¨× ×”×•×–× ×• ××“×“×™×";
            if(window.cW) window.cW.destroy();
            window.cW = new Chart(document.getElementById('chW'), {type:'line', data:{labels:DB.meas.map(m=>m.date), datasets:[{label:'××©×§×œ', data:DB.meas.map(m=>m.w), borderColor:'blue'}]}});
        },
        meds() {
            document.getElementById('med-list').innerHTML = DB.meds.map(m => `
                <div class="card" style="display:flex; justify-content:space-between;">
                    <div><b>${m.name}</b> (${m.dose})</div>
                    <button class="btn" style="width:auto; padding:5px 10px; background:var(--green); color:white;" onclick="Core.takeMed(${m.id})">× ×˜×™×œ×”</button>
                    <button onclick="Core.deleteMed(${m.id})">ğŸ—‘ï¸</button>
                </div>
            `).join('');
        },
        cal() {
            document.getElementById('cal-list').innerHTML = DB.logs.slice(0,20).map(l => `<div class="card"><b>${l.date} ${l.time}</b>: ${l.type} - ${l.detail}</div>`).join('');
        }
    };

    let nS = null, nSt = 0, nI = null;
    const Core = {
        initProfile() {
            DB.prof = { name: document.getElementById('reg-name').value, gender: document.getElementById('reg-gender').value };
            DB.save(); Nav.to('scr-home');
        },
        log(type, detail) {
            const now = new Date();
            DB.logs.unshift({ type, detail, date: now.toLocaleDateString('en-GB'), time: now.toLocaleTimeString('he-IL',{hour:'2-digit',minute:'2-digit'}), ts: Date.now() });
            DB.save(); UI.home();
        },
        doBath() {
            const diff = Date.now() - DB.lastBath;
            if(diff < 86400000) {
                const lastDate = new Date(parseInt(DB.lastBath)).toLocaleTimeString();
                UI.modal(`<h3>×¨×—×¦×” ×›×‘×¨ ×‘×•×¦×¢×”</h3><p>×‘×•×¦×¢×” ×¨×—×¦×” ×”×™×•× ×‘×©×¢×” ${lastDate}</p><button class="btn" onclick="UI.close()">×¡×’×•×¨</button>`);
            } else {
                DB.lastBath = Date.now();
                this.log('×¨×—×¦×”', '×‘×•×¦×¢×” ×¨×—×¦×”');
                UI.modal(`<h3>×¨×—×¦×” × ×¨×©××”!</h3><p>×”×›×¤×ª×•×¨ ×™×™×©××¨ ×¦×‘×•×¢ ×‘-24 ×”×©×¢×•×ª ×”×§×¨×•×‘×•×ª.</p><button class="btn" onclick="UI.close()">××¢×•×œ×”</button>`);
                UI.home();
            }
        },
        addMed() {
            const n = document.getElementById('m-name'), d = document.getElementById('m-dose'), v = document.getElementById('m-val');
            DB.meds.push({ id: Date.now(), name: n.value, dose: d.value, interval: v.value * 3600000 });
            DB.save();
            n.value = ''; d.value = ''; v.value = ''; // × ×™×§×•×™ ×©×“×•×ª!
            UI.meds();
        },
        takeMed(id) {
            const med = DB.meds.find(m => m.id === id);
            const last = DB.logs.find(l => l.type === '×ª×¨×•×¤×”' && l.detail.includes(med.name));
            if(last && (Date.now() - last.ts < med.interval)) {
                const diffHrs = Math.floor((Date.now() - last.ts) / 3600000);
                UI.modal(`<h3>âš ï¸ ××–×”×¨×ª ×›×¤×œ × ×˜×™×œ×”</h3><p>×”×ª×¨×•×¤×” × ×œ×§×—×” ×œ×¤× ×™ ${diffHrs} ×©×¢×•×ª.</p><button class="btn" onclick="Core.log('×ª×¨×•×¤×”','${med.name}'); UI.close();">××©×¨ ×‘×›×œ ×–××ª</button>`);
            } else { this.log('×ª×¨×•×¤×”', med.name); }
        },
        saveMeas() {
            const w = document.getElementById('ms-w').value;
            const last = DB.meas[DB.meas.length-1];
            if(last && (Date.now() - last.ts < 86400000)) {
                UI.modal(`<h3>××“×™×“×” ×¦×¤×•×¤×”</h3><p>×¢×‘×¨×• ×¤×—×•×ª ×-24 ×©×¢×•×ª. ×œ×©××•×¨?</p><button class="btn" onclick="Core.confirmMeas()">×›×Ÿ</button>`);
            } else { this.confirmMeas(); }
        },
        confirmMeas() {
            DB.meas.push({ w: document.getElementById('ms-w').value, h: document.getElementById('ms-h').value, date: new Date().toLocaleDateString('en-GB'), ts: Date.now() });
            DB.save(); UI.close(); Nav.to('scr-home');
        },
        generateReport() {
            const today = new Date().toLocaleDateString('en-GB');
            const logs = DB.logs.filter(l => l.date === today);
            const lastM = DB.meas[DB.meas.length-1] || {w:'-', h:'-'};
            
            const html = `
                <div style="direction:rtl; padding:20px;">
                    <h1>×“×•×— ×¨×¤×•××™ - ${DB.prof.name}</h1>
                    <p>×ª××¨×™×š: ${today}</p>
                    <hr>
                    <h3>××“×“×™× ××—×¨×•× ×™×:</h3>
                    <p>××©×§×œ: ${lastM.w} ×§"×’ | ×’×•×‘×”: ${lastM.h} ×¡"×</p>
                    <h3>×¤×¢×™×œ×•×ª ×”×™×•×:</h3>
                    <p>×—×™×ª×•×œ×™×: ${logs.filter(l=>l.type==='×—×™×ª×•×œ').length}</p>
                    <p>×”× ×§×”/×‘×§×‘×•×§: ${logs.filter(l=>l.type==='×”× ×§×”'||l.type==='×‘×§×‘×•×§').length} ××¨×•×—×•×ª</p>
                </div>
            `;
            const win = document.getElementById('print-area');
            win.innerHTML = html;
            window.print();
        },
        exportData() {
            const data = JSON.stringify(DB);
            const blob = new Blob([data], {type: 'application/json'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url; a.download = `zohar_backup_${new Date().toLocaleDateString()}.json`;
            a.click();
        }
    };

    Nav.to('scr-home');
</script>
</body>
</html>
